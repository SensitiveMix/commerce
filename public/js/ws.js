Is_WS=ibrowser.mobile;var WS_Config={};WS_Config.RemoteXmlUrl="/_Server.xml";WS_Config.JsReciveFun="ReceiveInfo";WS_Config.SocketServers=iWsServersStr.split(",");WS_Config.SocketServer="";WS_Config.SnKey="";WS_Config.TimeOutInt=3000;var WS_Soc;var WS_SysArg={};WS_SysArg.RoomID=iRoomID;var WS_ValidateArg={};var WS_Timer={};WS_Timer.MsgTime=0;WS_Timer.KeepLiveInterval=0;function WS_Connect(){iLog("开始连接WS");var TempSocIp=WS_Config.SocketServers.shift();WS_Config.SocketServer=TempSocIp;WS_Config.SocketServers.push(TempSocIp);WS_ConnectWs(WS_Config.SocketServer)}function WS_ConnectWs(url){WS_Soc=io.connect(url);WS_Soc.on("connect",function(){iLog("ws连接成功");var o={};o.Type="UL_Add";o.RoomID=WS_SysArg.RoomID;o.Data=[];o.Data.length=0;o.Data.push(GetSimpleUInfo());WS_Soc.emit("Message",o);IsLoaded()});WS_Soc.on("Message",function(data){iLog(data);ReceiveInfo(jQuery.parseJSON(data))});WS_Soc.on("disconnect",function(){iLog("断线重连")})}function WS_PostInfo(Msg){WS_Soc.emit("Message",Msg)}function iLog(e){return;console.info(e)}$(function(){if(Is_WS){WS_Connect()}});

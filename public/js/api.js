var _Player;var _iFlyMsgPlayer;var _MicIsOpen=false;var _CheckMsgList={};var UserListArr=[];var CustomerListArr=[];var _FormatStr={};_FormatStr.UserList='<li id="{0}" rid="{7}" uname="{1}" LevelID="{6}" Power="{9}" RoleID="{14}" RoleStyle="{12}" RoleTitle="{13}" ZberStyle="{18}" RoomRoleStyle="{16}" RoomRoleTitle="{17}" CustomerType="{19}" style="display:{20}"><div class="UBase" onmouseover="UBase_Over(this)" onmouseout="UBase_Out(this)" onclick="UBase_Click(this)"><img class="USoundStatus" src="/images/pixel.gif"><img class="US_Pic" src="{8}"><img class="USPicShadow" src="/images/pixel.gif"><img class="Role {12}" title="{13}" src="/images/pixel.gif"><img class="RM {15}" title="房管" src="/images/pixel.gif"><img class="RB {18}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {16}" title="{17}" src="/images/pixel.gif"><span title="{1}" class="UName" href="javascript:void(0)">{1}</span><span class="ULabel">（{0}）</span></div><div class="UShowPannel"><div class="US_List Shadow"><a class="US_List_Home" target="_blank" href="/Profile/?{0}">主页</a><a class="US_List_AddFriend" href="javascript:void(0)" onclick="AddFriend(this)">好友</a><a class="US_List_Heart" href="javascript:void(0)" onclick="Attention(this)">关注</a><a class="US_List_Black" href="javascript:void(0)" onclick="Menu_Black({0},\'{1}\')">屏蔽</a><a class="ManageLink" href="javascript:void(0)" onmouseover="ManageLink_Over(this)" onmouseout="ManageLink_Out(this)"><span class="US_List_Down" >操作</span></a></div></div></li>';_FormatStr.Guest='<li id="{0}" rid="{7}" uname="{1}" LevelID="{6}" Power="0" RoleID="0" CustomerType="{19}" style="display:{20}"><div class="UBase" onmouseover="UBase_Over(this)" onmouseout="UBase_Out(this)" onclick="UBase_Click(this)"><img class="USoundStatus" src="/images/pixel.gif"><img class="US_Pic" src="{8}"><img class="USPicShadow" src="/images/pixel.gif"><img class="RoomUserRole {16}" title="{17}" src="/images/pixel.gif"><img class="UPower UP0" src="/images/pixel.gif"><a class="UName" href="javascript:void(0)">{1}</a></div><div class="UShowPannel"><div class="US_List Shadow"><a class="US_List_Home" href="javascript:void(0)">主页</a><a class="US_List_AddFriend" href="javascript:void(0)">好友</a><a class="US_List_Heart" href="javascript:void(0)">关注</a><a class="US_List_Black" href="javascript:void(0)" onclick="Menu_Black({0},\'{1}\')">屏蔽</a><a class="ManageLink" href="javascript:void(0)" onmouseover="ManageLink_Over(this)" onmouseout="ManageLink_Out(this)"><span class="US_List_Down" >操作</span></a></div></div></li>';
_FormatStr.MicList='<li id="M{0}" rid="{7}" uname="{1}" class="t"><img class="USoundStatus" src="/images/pixel.gif"><img class="UPower" src="/images/pixel.gif"><a class="UName" href="javascript:void(0)">{1}</a><a class="DelMic" href="javascript:void(0)" onclick="DelMicList({0})" title="删除此用户麦序">删麦序</a></li>';_FormatStr.PublicMsg='<li class="" id="M_{6}" MID="{20}"><span class="t">{5} </span><img class="Role {10}" src="/images/pixel.gif" title="{21}"><img class="RM {18}" title="房管" src="/images/pixel.gif"><img class="RB {11}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {12}" title="{13}" src="/images/pixel.gif"><a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{0}" uname="{1}" power="{8}" RoleStyle="{10}" ZberStyle="{11}" RoomRoleStyle="{12}" RoomRoleTitle="{13}">{1} ：</a><span class="m {18} {11}">{4}</span></li>';_FormatStr.PublicMsg_ViewPoint='<li class="" id="M_{6}"><span class="t">{5} </span><span class="Head_ViewPoint" onclick="ShowViewPointZoom()">观点</span><img class="Role {10}" src="/images/pixel.gif" title="{20}"><img class="RM {18}" title="房管" src="/images/pixel.gif"><img class="RB {11}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {12}" title="{13}" src="/images/pixel.gif"><a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{0}" uname="{1}" power="{8}" RoleStyle="{10}" ZberStyle="{11}" RoomRoleStyle="{12}" RoomRoleTitle="{13}">{1} ：</a><span class="m">{4}</span></li>';_FormatStr.PublicMsg_Check='<li class="" id="M_{6}" MID="{20}"><span class="t">{5} </span><img class="Role {10}" src="/images/pixel.gif" title="{21}"><img class="RM {18}" title="房管" src="/images/pixel.gif"><img class="RB {11}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {12}" title="{13}" src="/images/pixel.gif"><a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{0}" uname="{1}" power="{8}" RoleStyle="{10}" ZberStyle="{11}" RoomRoleStyle="{12}" RoomRoleTitle="{13}">{1} ：</a><span class="m {18} {11}">{4}</span><a class="check" href="javascript:void(0)" onclick="CheckMsg_True(\'{6}\',this)" id="{6}">审核通过</a><a class="del" href="javascript:void(0)" onclick="DelMsg(\'{6}\')">删</a></li>';
_FormatStr.PublicMsg_ToPerson='<li class="" id="M_{6}" MID="{20}"><span class="t">{5} </span><img class="Role {10}" src="/images/pixel.gif" title="{21}"><img class="RM {18}" title="房管" src="/images/pixel.gif"><img class="RB {11}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {12}" title="{13}" src="/images/pixel.gif"><a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{0}" uname="{1}" power="{8}" RoleStyle="{10}" ZberStyle="{11}" RoomRoleStyle="{12}" RoomRoleTitle="{13}">{1} </a> <span class="m noclear">对</span><img class="Role {14}" src="/images/pixel.gif" title="{22}"><img class="RM {19}" title="房管" src="/images/pixel.gif"><img class="RB {15}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {16}" title="{17}" src="/images/pixel.gif"> <a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{2}" uname="{3}" power="{9}" RoleStyle="{14}" ZberStyle="{15}" RoomRoleStyle="{16}" RoomRoleTitle="{17}">{3}  ：</a><span class="m {18} {11}">{4}</span></li>';_FormatStr.PublicMsg_ToPerson_Check='<li class="" id="M_{6}" MID="{20}"><span class="t">{5} </span><img class="Role {10}" src="/images/pixel.gif" title="{21}"><img class="RM {18}" title="房管" src="/images/pixel.gif"><img class="RB {11}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {12}" title="{13}" src="/images/pixel.gif"><a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{0}" uname="{1}" power="{8}" RoleStyle="{10}" ZberStyle="{11}" RoomRoleStyle="{12}" RoomRoleTitle="{13}">{1} </a> <span class="m noclear">对</span><img class="Role {14}" src="/images/pixel.gif" title="{22}"><img class="RM {19}" title="房管" src="/images/pixel.gif"><img class="RB {15}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {16}" title="{17}" src="/images/pixel.gif"> <a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{2}" uname="{3}" power="{9}" RoleStyle="{14}" ZberStyle="{15}" RoomRoleStyle="{16}" RoomRoleTitle="{17}">{3}  ：</a><span class="m {18} {11}">{4}</span><a class="check" href="javascript:void(0)" onclick="CheckMsg_True(\'{6}\',this)" id="{6}">审核通过</a><a class="del" href="javascript:void(0)" onclick="DelMsg(\'{6}\')">删</a></li>';
_FormatStr.PrivateMsg_ToPerson='<li class=""><span class="t">{5} </span><img class="Role {10}" src="/images/pixel.gif"><img class="RM {18}" title="房管" src="/images/pixel.gif"><img class="RB {11}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {12}" title="{13}" src="/images/pixel.gif"><a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{0}" uname="{1}" power="{6}" RoleStyle="{10}" ZberStyle="{11}" RoomRoleStyle="{12}" RoomRoleTitle="{13}">{1} </a> <span class="m noclear">对</span><img class="Role {14}" src="/images/pixel.gif"><img class="RM {19}" title="房管" src="/images/pixel.gif"><img class="RB {15}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {16}" title="{17}" src="/images/pixel.gif"> <a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{2}" uname="{3}" power="{7}" RoleStyle="{14}" ZberStyle="{15}" RoomRoleStyle="{16}" RoomRoleTitle="{17}">{3}  ：</a><span class="m {18} {11}">{4}</span></li>';_FormatStr.SysMsg='<li class="notice"><span class="t">{1}</span><span class="sys">系统消息 ： {0}</span></li>';_FormatStr.EnterMsg='<li class="notice"><span class="t">{2}</span><span class="gary">系统消息 ： <b class="black"><a onclick="LinkLayerClick(this)" href="javascript://" class="ub" uid="{0}" uname="{1}" power="{9}">{1}</a></b> 进入了房间。</span></li>';_FormatStr.KickMsg='<li class="notice"><span class="t">{2}</span><span class="gary">系统消息 ： 管理员 <b class="black">{0}</b> 将 <b class="black">{1}</b> 踢出了房间。</span></li>';_FormatStr.BlackKickMsg='<li class="notice"><span class="t">{2}</span><span class="gary">系统消息 ： 管理员 <b class="black">{0}</b> 将 <b class="black">{1}</b> 踢出了房间。</span></li>';_FormatStr.SilentMsg='<li class="notice"><span class="t">{2}</span><span class="gary">系统消息 ： <b class="black">{1}</b> 被 管理员 <b class="black">{0}</b> 禁言5分钟。</span></li>';_FormatStr.UnSilentMsg='<li class="notice"><span class="t">{2}</span><span class="gary">系统消息 ： 管理员 <b class="black">{0}</b> 恢复 <b class="black">{1}</b> 的发言。</span></li>';_FormatStr.ManagerMsg='<li class="notice"><span class="t">{2}</span><span class="gary">系统消息 ： <b class="black">{1}</b> 被 <b class="black">{0}</b> 设置为管理员。</span></li>';
_FormatStr.UnManagerMsg='<li class="notice"><span class="t">{2}</span><span class="gary">系统消息 ： <b class="black">{1}</b> 被 <b class="black">{0}</b> 撤销管理员身份。</span></li>';_FormatStr.BlackMsg='<li class="notice"><span class="t">{1}</span><span class="gary">系统消息 ： 已屏蔽 <b class="black">{0}</b> 的聊天信息 。</span></li>';_FormatStr.UnBlackMsg='<li class="notice"><span class="t">{1}</span><span class="gary">系统消息 ： 已解除 <b class="black">{0}</b> 的信息屏蔽。</span></li>';_FormatStr.MsgSharePic='<span class="pic"><a href="javascript:void(0)" title="双击放大" ondblclick="MsgPic_LargeZoom(this)" class="cursorDefault"><img src="'+_Config.DynamicFileServer+'/UserUpload/MsgPic/{0}" onerror="javascript:this.src=\'/images/noPic.jpg\';" onload="MsgScrollToBottom()"></a><div class="{1}"><a href="javascript:void(0)" t="'+_Config.DynamicFileServer+'/UserUpload/MsgPic/{0}" onclick="Set_SharePic(this)" class="share">分享到贴图</a></div><a class="LargeZoom" rel="MsgSharePic" href="'+_Config.DynamicFileServer+'/UserUpload/MsgPic/{0}" title="放大">放大</a></span>';_FormatStr.MsgShareListPic='<div id="SharePic{3}" class="picZoom"><a class="pic" href="{1}" title="" rel="sharepic"><img src="{1}"/><div class="mask"><div class="title">{0}</div><div class="date">{2}</div></div></a><span title="删除" onclick="SharePic_Del({3})" class="SharePic_Del">删除</span></div>';_FormatStr.FaceArry=["赞","up","kiss","来电","贱笑","陶醉","兴奋","鄙视","得意","偷笑","挖鼻孔","衰","流汗","伤心","鬼脸","狂笑","发呆","害羞","可怜","气愤","惊吓","困了","再见","感动","晕","可爱","潜水","强","囧","窃笑","疑问","装逼","抱歉","鼻血","睡觉","委屈","笑哈哈","贱贱地笑","被电","转发","求关注","路过这儿","好激动","招财","加油啦","转转","围观","推撞","来嘛","啦啦啦","切克闹","给力","威武","流血"];_FormatStr.GuestUserCard='<div class="Card_Base"><div class="Base_Left"><img src="/images/DefaultFace.png"></div><div class="Base_Right"><div class="Base_NickName"><img src="/images/pixel.gif" class="Base_Sex Female"/>{0}</div><div class="Base_Area"></div><span class="Card_CloseBt" onclick="User_Crad_Close()">关闭</span></div></div><div class="Card_Detail"><div class="Detail_List On"><a href="#" onclick="javascript:void(0)"><span>0</span><div class="clr5"></div><span class="Detail_Label">订阅</span></a></div><div class="Detail_List" style="width:34%;"><a href="#" onclick="javascript:void(0)"><span>0</span><div class="clr5"></div><span class="Detail_Label">跟单</span></a></div><div class="Detail_List"><a href="#" onclick="javascript:void(0)"><span>0</span><div class="clr5"></div><span class="Detail_Label">喊单</span></a></div></div>';
_FormatStr.PopBox='<div title="" class="PopBox_Title">{0}</div><div class="PopBox_Content"><div class="PopBox_Content_List"><ul></ul></div></div>';_FormatStr.RedBad='<li class="" id="M_{6}"><span class="t">{5} </span><img class="Role {10}" title="{20}" src="/images/pixel.gif"><img class="RM {18}" title="房管" src="/images/pixel.gif"><img class="RB {11}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {12}" title="{13}" src="/images/pixel.gif"><a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="{0}" uname="{1}" power="{8}" RoleStyle="{10}" ZberStyle="{11}" RoomRoleStyle="{12}" RoomRoleTitle="{13}">{1} ：</a><span class="m">赠送1个红包<em class="redbag"></em></span></li>';_FormatStr.PrivatePopUL='<li uid="{0}" id="PrivatePopUL_{0}" uname="{1}" power="{2}" rolestyle="{3}" roletitle="{4}" roomrolestyle="{5}" roomroletitle="{6}" zberstyle="{7}" class="" ><img src="{8}"><a class="uname" href="javascript:void(0)">{1}</a><a class="PrivatePopUserClose" href="javascript:void(0)">关闭</a><span class="UserMsgNum show" style="display: none;">0</span></li>';_FormatStr.PrivatePopMsgList='<div class="PrivatePopUIDMsgList" id="PrivatePop_MsgList_{0}" style="display: none;"><ul></ul></div>';_FormatStr.SendGiftMsg='<li><span class="t">09:23 </span><img class="Role {4}" src="/images/pixel.gif" title="{3}"><img class="RM {16}" title="房管" src="/images/pixel.gif"><img class="RB {5}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {6}" title="{7}" src="/images/pixel.gif"><a roomroletitle="{7}" roomrolestyle="{6}" zberstyle="{5}" rolestyle="{4}" power="{2}" uname="{1}" uid="{0}" class="u" href="javascript://" onclick="LinkLayerClick(this)">{1}</a><span class="m">赠送</span><img class="Role {12}" src="/images/pixel.gif" title="{11}"><img class="RM {17}" title="房管" src="/images/pixel.gif"><img class="RB {13}" title="主播" src="/images/pixel.gif"><img class="RoomUserRole {15}" title="{14}" src="/images/pixel.gif"><a class="u" roomroletitle="{14}" roomrolestyle="{15}" zberstyle="{13}" rolestyle="{12}" power="{10}" uname="{9}" uid="{8}" href="javascript://" onclick="LinkLayerClick(this)">{9} </a><span class="m sendgift"><em>{20}个</em><img src="{19}"></span></li>';
_FormatStr.QuickReplyMsg = '<li class="" id="M_7000" MID="7000"><span class="t">{2} </span><img class="Role {3}" src="/images/pixel.gif" title=""><img class="RM " title="房管" src="/images/pixel.gif"><img class="RB " title="主播" src="/images/pixel.gif"><img class="RoomUserRole " title="" src="/images/pixel.gif"><a onclick="LinkLayerClick(this)" href="javascript://" class="u" uid="7000" uname="{0}" power="1" RoleStyle="" ZberStyle="" RoomRoleStyle="RoomUser4" RoomRoleTitle="自言">{0} ：</a><span class="m ">{1}</span></li>';
function IsLoaded(){_Config.SwfLoaded=true;_Player=getSWF(_Config.PlayerID);_iFlyMsgPlayer=getSWF("iFlyMsgPlayer");KeyPressHandler();EnableUI();CheckSpeakPower()}function FixMsgInfo(Type,Json){setTimeout(function(){switch(Type){case"UL_Cache":AddUserByJson(Json);break;case"Manager_Cache":CacheManagerByJson(Json);break;case"UL_Enter":EnterRoomByJson(Json);break;case"UL_Leave":DelUserByJson(Json);break;case"MM_Cache":ChangeModeTypeByJson(Json);break;case"MM_Change":ChangeModeTypeByJson(Json,true);break;case"ML_Status_Change":ChangeMicListStatusByJson(Json);break;case"ML_Status_Cache":ChangeMicListStatusByJson(Json);break;case"ML_Cache":AddMicUserByJson(Json);break;case"ML_Up":AddMicUserByJson(Json,false);break;case"ML_Down":DelMicUserByJson(Json);break;case"ML_Clear":ClearMicListUI();break}},10)}var IsFirstLoad=true;function AddUserByJson(JsonStr){var Json=eval("("+JsonStr+")");SetOnlineUserNum(Json.OnlineNum);if(Json.Index!="null"){GetMoreUL_Index=Json.Index}var user_index=0;$.each(Json.Data,function(i,e){if(e.hasOwnProperty("UserID")&&e.hasOwnProperty("UserNickName")&&e.hasOwnProperty("LevelID")&&e.hasOwnProperty("EnterTime")){user_index=user_index+1;if(user_index<100){AddUser(e)}}});SetCustomerNum();DisGetMoreUserList(Json.OnlineNum);if(IsFirstLoad){$("#User_List li:first").addClass("t");$("#User_List li:first .UBase").addClass("on");$("#User_List li:first .UShowPannel").css({height:_Config.USList_Height,opacity:1});IsFirstLoad=false}}function SetCustomerNum(){var iNum=$('#Y_User_List  li[CustomerType!="-1"][id!="MoreUserlist"]').length;$("#CustomerNum").html(iNum)}function DisGetMoreUserList(OnlineNum){if(OnlineNum>UserListArr.length){$("#MoreUserlist").css({"display":"inline-block"})}else{$("#MoreUserlist").css({"display":"none"})}UpdateScrollbar()}var GetMoreUL_Index=1;function GetMoreUserList(){var e={};e.Type="More_UL";e.RoomID=iRoomID;e.Index=GetMoreUL_Index;Fix_PostInfo(e);GetMoreUL_Index=GetMoreUL_Index+1}function SetOnlineUserNum(Num){if(Num==""||Num==null||isNaN(Num)){return
}$("#RoomOnline").text(Num+RbNum);_Config.CurrentULNum=Num}function CacheManagerByJson(JsonStr){var Json=eval("("+JsonStr+")")}function EnterRoomByJson(JsonStr){var Json=eval("("+JsonStr+")");SetOnlineUserNum(Json.OnlineNum);$.each(Json.Data,function(i,e){if(_Config.CurrentULNum<100){EnterRoom(e);if(e.IsLogin&&e.UserID!=iInfo.UserID){var o={};o.Type="Enter_Msg";o.PostUID=e.UserID;o.PostUName=unescape(e.UserNickName);if(_SysConfig.ShowEnterLeaveMsg==1){ReceiveInfo(o)}}}});SetCustomerNum();DisGetMoreUserList(Json.OnlineNum)}function EnterRoom(e){if(String(iRoomID)==String(e.RoomID)){e.LevelID=99999999}if($("#User_List").find("#"+e.UserID).length>0){var tUser=$("#User_List").find("#"+e.UserID);tUser.attr({roleid:e.RoleID,power:e.Power,levelid:e.LevelID,uname:unescape(e.UserNickName),rid:e.RoomID});tUser.find(".UName span").text(unescape(e.UserNickName));tUser.find(".US_Pic")[0].src=unescape(unescape(e.FacePic?e.FacePic:_Config.DefaultFacePic));tUser.find(".Role").attr({title:unescape(e.RoleName)});tUser.find(".Role")[0].className="Role "+e.RoleCssStyle;if(e.IsManager){if(!tUser.find(".RM").hasClass("RoomManager")){tUser.find(".RM").addClass("RoomManager")}}else{tUser.find(".RM").removeClass("RoomManager")}return}var index=GetUserFromArray(e.UserID);if(index>-1){UserListArr.splice(index,1)}if(e.UserID==""){return false}UserListArr.push(e);var NewMsgHtml=$.format(e.IsLogin?_FormatStr.UserList:_FormatStr.Guest,e.UserID,unescape(unescape(e.UserNickName)),e.LevelClass,e.VIPIcon,e.BestAccount,e.FixIcon,e.LevelID,e.RoomID,unescape(unescape(e.FacePic?e.FacePic:_Config.DefaultFacePic)),e.Power,e.time,iInfo.Power<1000?"none":"",e.RoleCssStyle,unescape(e.RoleName),e.RoleID,e.IsManager?"RoomManager":"",e.RoomRoleStyle,unescape(e.RoomRoleTitle),e.IsZber?"RoomBo":"",CheckTempCustomer(e.UserID)?"0":"-1",CheckUserListMode(e)?"list-item":"none");ListAddSort($("#User_List"),e,NewMsgHtml)}function ChangeModeTypeByJson(JsonStr,ShowMsg){ShowMsg=ShowMsg||false;var Json=eval("("+JsonStr+")");
$.each(Json.Data,function(i,e){ChangeModeType(e.V);if(ShowMsg){var o={};o.Type="Sys_Public";o.Msg="房间发言模式已变更为："+_Config.ModeTypeDes[parseInt(e.V)]+" 。";ReceiveInfo(o)}})}function ChangeMicListStatusByJson(JsonStr){var Json=eval("("+JsonStr+")");$.each(Json.Data,function(i,e){if(e.hasOwnProperty("StopApply")){FlashSetChangeStopApply(e.StopApply)}if(e.hasOwnProperty("MicManage")){FlashSetChangeMicManage(e.MicManage)}})}function DelMicUserByJson(JsonStr){var Json=eval("("+JsonStr+")");$.each(Json.Data,function(i,e){try{$("#MicList")[0].removeChild($("#MicList").find("#M"+e.UserID)[0])}catch(err){}})}function ClearMicListUI(){$("#MicList").html("")}function AddMicUserByJson(JsonStr,Is_Ml_Up){var Json=eval("("+JsonStr+")");if(Is_Ml_Up!=false){$.each($("#MicList li"),function(i,e){if(FindObjectFromJson(e.id.split("M")[1],Json.Data)==false){try{$("#MicList")[0].removeChild($(e)[0])}catch(err){}}})}$.each(Json.Data,function(i,e){AddMicUser(e)})}function FindObjectFromJson(uid,data){var re=false;$.each(data,function(i,e){if(e.UserID==uid){re=true}});return re}function AddUser(e){if(String(iRoomID)==String(e.RoomID)){e.LevelID=99999999}var index=GetUserFromArray(e.UserID);if(index>-1){UserListArr.splice(index,1)}if(e.UserID==""){return false}UserListArr.push(e);var NewMsgHtml=$.format(e.IsLogin?_FormatStr.UserList:_FormatStr.Guest,e.UserID,unescape(unescape(e.UserNickName)),e.LevelClass,e.VIPIcon,e.BestAccount,e.FixIcon,e.LevelID,e.RoomID,unescape(unescape(e.FacePic?e.FacePic:_Config.DefaultFacePic)),e.Power,e.time,iInfo.Power<1000?"none":"",e.RoleCssStyle,unescape(e.RoleName),e.RoleID,e.IsManager?"RoomManager":"",e.RoomRoleStyle,unescape(e.RoomRoleTitle),e.IsZber?"RoomBo":"",CheckTempCustomer(e.UserID)?"0":"-1",CheckUserListMode(e)?"list-item":"none");ListAddSort($("#User_List"),e,NewMsgHtml)}function CheckTempCustomer(uid){var re=false;$.each(_Crm.TempCustomer.split(","),function(name,value){if(value==uid){re=true}});return re}function CheckUserListMode(e){var Re=false;if(UserListMode==0){Re=e.Power>=1000?true:false
}else{if(UserListMode==2){Re=CheckTempCustomer(e.UserID)}else{Re=true}}return Re}function Fix_PostInfo(e){_Player._Fix_PostInfo(e)}function Post_MM_Change(mt){if(iInfo.IsManager==false){iTip("您无权修改房间模式！");return}var e={};e.Type="MM_Change";e.RoomID=iRoomID;e.Data=[];e.Data.push({V:mt});Fix_PostInfo(e)}function ApplyMicList(){if(CheckSpeakPower_UI()==false){return}if(iInfo.IsLogin==false){iTip("游客无法上麦发言！");return}if(_Config.Mic_StopApply){return}var e={};e.Type="ML_Up";e.RoomID=iRoomID;Fix_PostInfo(e)}function DelMicList(uid){uid=String(uid);if(iInfo.Power<1000&&iInfo.UserID!=uid){iTip("您无权下麦！");return}var e={};e.Type="ML_Down";e.RoomID=iRoomID;e.Data=[];e.Data.push({UID:uid});Fix_PostInfo(e)}function StopApply(){if(iInfo.Power<1000){iTip("您无权禁麦！");return}var e={};e.Type="ML_Status_Change";e.RoomID=iRoomID;e.Data=[];e.Data.push({"StopApply":!_Config.Mic_StopApply});Fix_PostInfo(e)}function MicManage(){if(iInfo.Power<1000){iTip("您无权控麦！");return}var e={};e.Type="ML_Status_Change";e.RoomID=iRoomID;e.Data=[];e.Data.push({"MicManage":!_Config.Mic_Manage});Fix_PostInfo(e)}function ClearMicList(){if(iInfo.Power<1000){iTip("您无权清麦！");return}var e={};e.Type="ML_Clear";e.RoomID=iRoomID;Fix_PostInfo(e)}function AddMicTime(){if(iInfo.Power<1000){iTip("您无权加时！");return}var e={};e.Type="ML_Status_AddMicTime";e.RoomID=iRoomID;Fix_PostInfo(e)}function CreatPlayer(e){if(e.UserID==iInfo.UserID){return false}_Player._CreatPlayer(e.UserID)}function AddMicUser(e){if($("#M"+e.UserID).length>0){return}var NewMsgHtml=$.format(_FormatStr.MicList,e.UserID,unescape(e.UserNickName),e.LevelClass,e.VIPIcon,e.BestAccount,e.FixIcon,e.LevelID,e.RoomID,unescape(unescape(e.FacePic?e.FacePic:_Config.DefaultFacePic)),e.Power,e.time);$("#MicList").append(NewMsgHtml)}function ListAddSort(List,e,Html){if(String(iRoomID)==String(e.RoomID)){e.LevelID=99999999}if(List.find("#"+e.UserID).length>0){var tUser=List.find("#"+e.UserID);tUser.attr({roleid:e.RoleID,power:e.Power,levelid:e.LevelID,uname:unescape(e.UserNickName),rid:e.RoomID});
tUser.find(".UName span").text(unescape(e.UserNickName));tUser.find(".US_Pic")[0].src=unescape(unescape(e.FacePic?e.FacePic:_Config.DefaultFacePic));tUser.find(".Role").attr({title:unescape(e.RoleName)});try{tUser.find(".Role")[0].className="Role "+e.RoleCssStyle}catch(err){}if(e.IsManager){if(!tUser.find(".RM").hasClass("RoomManager")){tUser.find(".RM").addClass("RoomManager")}}else{tUser.find(".RM").removeClass("RoomManager")}return}var MaxDom;if(Number(List.find("li:first").attr("LevelID"))<Number(e.LevelID)||Number(iRoomID)==Number(e.RoomID)){List.prepend(Html)}else{if(Number(List.find("li:last").attr("LevelID"))>Number(e.LevelID)){List.append(Html)}else{List.find("li").each(function(){if(Number($(this).attr("LevelID"))>Number(e.LevelID)){MaxDom=$(this)}});if(MaxDom){MaxDom.after(Html)}else{List.prepend(Html)}}}}function DelUserUI(UID){try{$("#User_List")[0].removeChild($("#User_List").find("#"+UID)[0])}catch(err){}try{$("#MicList")[0].removeChild($("#MicList").find("#"+UID)[0])}catch(err){}}function DelUserByJson(JsonStr){var Json=eval("("+JsonStr+")");SetOnlineUserNum(Json.OnlineNum);$.each(Json.Data,function(i,e){DelUserByUID(String(e.UserID))});DisGetMoreUserList(Json.OnlineNum);SetCustomerNum()}function DelUserByUID(UID){if(UID==iInfo.UserID){return}DelUserUI(UID);var index=GetUserFromArray(UID);if(index>-1){UserListArr.splice(index,1)}}function CheckUserFromArray(UID){var Re=false;$.each(UserListArr,function(i,n){if(String(n.UserID)==String(UID)){Re=true}});return Re}function GetUserFromArray(UID){var Re;$.each(UserListArr,function(i,n){if(String(n.UserID)==String(UID)){Re=Number(i)}});return Re}function SetMenuCurrent(e){_Config.MenuCurrentUID=e.UID;_Config.MenuCurrentUname=e.Uname;_Config.MenuCurrentPower=e.Power;_Config.MenuCurrentRoleStyle=e.RoleStyle;_Config.MenuCurrentRoleTitle=e.RoleTitle;_Config.MenuCurrentZberStyle=e.ZberStyle;_Config.MenuCurrentRoomRoleStyle=e.RoomRoleStyle;_Config.MenuCurrentRoomRoleTitle=e.RoomRoleTitle;_Config.MenuCurrentUPic=e.UPic
}function Manage_Kick(){$.get("/handle/CheckPowerKey.asp",{ac:"CheckPowerKey",uid:_Config.MenuCurrentUID,key:"5999af91220494dd529ab97c5ffaead5",rid:iRoomID,t:GetSendTime()},function(){if(CheckPowerKey==true){if(!iInfo.IsManager){iTip("您不是该房间管理员,无权限进行操作！");return}if(_Config.MenuCurrentPower>=1999||_Config.MenuCurrentUID==0){iTip("无权限！");return false}var o={};o.Type="Manage_Kick";o.ReceiveRID=iInfo.Live_NG_ID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.ReceiveUID=_Config.MenuCurrentUID;o.ReceiveUName=GB2312UnicodeConverter.ToUnicode(_Config.MenuCurrentUname);o.Time=GetSendTime();PostMsg(o);_Player._DelUser(_Config.MenuCurrentUID)}else{iTip(CheckPowerKey)}},"script");$("#Y_ManageMenu").hide()}function Manage_BlackKick(){$.get("/handle/CheckPowerKey.asp",{ac:"CheckPowerKey",uid:_Config.MenuCurrentUID,key:"5999af91220494dd529ab97c5ffaead5",rid:iRoomID,t:GetSendTime()},function(){if(CheckPowerKey==true){if(!iInfo.IsManager){iTip("您不是该房间管理员,无权限进行操作！");return}if(_Config.MenuCurrentPower>=1999){iTip("无权限！");return false}var o={};o.Type="Manage_BlackKick";o.ReceiveRID=iInfo.Live_NG_ID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.ReceiveUID=_Config.MenuCurrentUID;o.ReceiveUName=GB2312UnicodeConverter.ToUnicode(_Config.MenuCurrentUname);o.Time=GetSendTime();PostMsg(o);$.get("/handle/SetBlackKick.asp",{ac:"SetBlackKick_Manage",rid:iRoomID,uid:o.ReceiveUID,t:GetSendTime()},function(){});_Player._DelUser(_Config.MenuCurrentUID)}else{iTip(CheckPowerKey)}},"script");$("#Y_ManageMenu").hide()}function Manage_Silent(){$.get("/handle/CheckPowerKey.asp",{ac:"CheckPowerKey",uid:_Config.MenuCurrentUID,key:"f72e4e023d13d518d3c4f2db31117b2d",rid:iRoomID,t:GetSendTime()},function(){if(CheckPowerKey==true){if(!iInfo.IsManager){iTip("您不是该房间管理员,无权限进行操作！");return}if(_Config.MenuCurrentPower>=1999||_Config.MenuCurrentUID==0){iTip("无权限！");return false}var o={};o.Type="Manage_Silent";o.ReceiveRID=iInfo.Live_NG_ID;
o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.ReceiveUID=_Config.MenuCurrentUID;o.ReceiveUName=GB2312UnicodeConverter.ToUnicode(_Config.MenuCurrentUname);o.Time=GetSendTime();PostMsg(o)}else{iTip(CheckPowerKey)}},"script");$("#Y_ManageMenu").hide()}function Manage_UnSilent(){if(!iInfo.IsManager){iTip("您不是该房间管理员,无权限进行操作！");return}if(_Config.MenuCurrentPower>=1999||_Config.MenuCurrentUID==0){iTip("无权限！");return false}var o={};o.Type="Manage_UnSilent";o.ReceiveRID=iInfo.Live_NG_ID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.ReceiveUID=_Config.MenuCurrentUID;o.ReceiveUName=GB2312UnicodeConverter.ToUnicode(_Config.MenuCurrentUname);o.Time=GetSendTime();PostMsg(o);$("#Y_ManageMenu").hide()}function Manage_Manager(){if(!iInfo.IsManager){iTip("您不是该房间超管,无权限进行操作！");return}if(iInfo.Power<1999){iTip("您不是该房间超管,无权限进行操作！");return}if(_Config.MenuCurrentPower>=1999||_Config.MenuCurrentUID==0){iTip("无权限！");return false}$("#Y_ManageMenu").hide();$.get("/handle/SetManager.asp",{ac:"SetManager",uid:_Config.MenuCurrentUID,rid:iRoomID,t:GetSendTime()},function(){if(Manager==true){var o={};o.Type="Manage_Manager";o.ReceiveRID=iInfo.Live_NG_ID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.ReceiveUID=_Config.MenuCurrentUID;o.ReceiveUName=GB2312UnicodeConverter.ToUnicode(_Config.MenuCurrentUname);o.Time=GetSendTime();PostMsg(o)}else{iTip("权限不足！");return}},"script")}function Manage_UnManager(){if(!iInfo.IsManager){iTip("您不是该房间超管,无权限进行操作！");return}if(iInfo.Power<1999){iTip("您不是该房间超管,无权限进行操作！");return}if(_Config.MenuCurrentPower>=1999||_Config.MenuCurrentUID==0){iTip("无权限！");return false}$("#Y_ManageMenu").hide();$.get("/handle/UnManager.asp",{ac:"UnManager",uid:_Config.MenuCurrentUID,rid:iRoomID,t:GetSendTime()},function(){if(Manager==true){var o={};o.Type="Manage_UnManager";o.ReceiveRID=iInfo.Live_NG_ID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);
o.ReceiveUID=_Config.MenuCurrentUID;o.ReceiveUName=GB2312UnicodeConverter.ToUnicode(_Config.MenuCurrentUname);o.Time=GetSendTime();PostMsg(o)}else{iTip("权限不足！");return}},"script")}function Manage_SetRoomUserRole(RoleID){if(!iInfo.IsManager){iTip("您不是该房间管理员,无权限进行操作！");return}if(_Config.MenuCurrentPower>=1999||_Config.MenuCurrentUID==0){iTip("无权限！");return false}$("#Y_ManageMenu").hide();$.get("/handle/SetRoomRole.asp",{ac:"SetRoomRole",uid:_Config.MenuCurrentUID,rid:iRoomID,roleid:RoleID,t:GetSendTime()},function(){if(SetRoomRole==true){$("#"+_Config.MenuCurrentUID+" .RoomUserRole").attr("className","RoomUserRole "+RoomUserRoleCache[RoleID]["style"]);$("#"+_Config.MenuCurrentUID+" .RoomUserRole").attr({"title":RoomUserRoleCache[RoleID]["title"]});var o={};o.Type="Manage_SetRoomUserRole";o.ReceiveRID=iInfo.Live_NG_ID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.ReceiveUID=_Config.MenuCurrentUID;o.ReceiveUName=GB2312UnicodeConverter.ToUnicode(_Config.MenuCurrentUname);o.RoleID=RoleID;o.Time=GetSendTime();PostMsg(o)}else{iTip("权限不足！");return}},"script")}function SetRoomUserRole(o){$("#"+o.ReceiveUID+" .RM").removeClass("RoomManager");$("#"+o.ReceiveUID+" .RoomUserRole")[0].className="RoomUserRole "+RoomUserRoleCache[o.RoleID]["style"];$("#"+o.ReceiveUID+" .RoomUserRole").attr({"title":RoomUserRoleCache[o.RoleID]["title"]});if(o.ReceiveUID==iInfo.UserID){iInfo.RoomRolePowerKeys=RoomUserRoleCache[o.RoleID]["keys"];iInfo.RoomRoleStyle=RoomUserRoleCache[o.RoleID]["style"];iInfo.RoomRoleTitle=RoomUserRoleCache[o.RoleID]["title"];iTip("您的角色已被更改，"+RoomUserRoleCache[o.RoleID]["title"])}CheckSpeakPower()}function Menu_Black(uid,uname){if(_Config.BlackList.hasOwnProperty(uid)){delete _Config.BlackList[uid];var o={};o.Type="Menu_UnBlack";o.ReceiveUName=uname;o.Time=GetSendTime();ReceiveInfo(o)}else{_Config.BlackList[uid]=uname;var o={};o.Type="Menu_Black";o.ReceiveUName=uname;o.Time=GetSendTime();ReceiveInfo(o)}}function InBlackList(uid){if(_Config.BlackList.hasOwnProperty(uid)){return true
}else{return false}}function Attention(e){var C_Parent=$(e).parent().parent().parent();var C_UID=parseInt(C_Parent[0].id);var C_UPower=parseInt(C_Parent.attr("power"));if(C_UPower==0){iTip("无法关注游客！");return false}if(C_UID==0){return false}if(iInfo.UserID==C_UID){iTip("无法关注自己！");return false}$.get("/handle/Attention.asp",{ac:"Attention",guid:C_UID,t:GetSendTime()},function(){if(AttentionRe==true){$(e).addClass("US_List_Heart_On")}else{$(e).addClass("US_List_Heart_On")}},"script")}function AddFriend(e){if(_SysConfig.OpenFriend==0){iTip("好友功能已关闭！");return false}var C_Parent=$(e).parent().parent().parent();var C_UID=parseInt(C_Parent[0].id);var C_UPower=parseInt(C_Parent.attr("power"));if(C_UPower==0){iTip("无法关注游客！");return false}if(C_UID==0){return false}if(iInfo.UserID==C_UID){iTip("无法添加自己为好友！");return false}$.get("/handle/AddFriend.asp",{ac:"AddFriend",guid:C_UID,t:GetSendTime()},function(){if(AddFriend==true){iTip("发送好友申请成功！")}else{iTip("不能重复发送好友申请！")}},"script")}function FeedRoom(e){$.get("/handle/Feed.asp",{ac:"FeedRoom",rid:iRoomID,t:GetSendTime()},function(){if(FeedRe==true){$(e).text("已订阅")}else{if(FeedRe==false){$(e).text("订阅")}else{}}},"script")}function Sale_GetQQ(){if(iInfo.IsManager!=true){iTip("您不是该房间管理员,无权限进行操作！");return}if(_Config.MenuCurrentUID==0){iTip("无权限！");return false}Post_GetQQ(_Config.MenuCurrentUID);$("#Y_ManageMenu").hide()}function Sale_AddTempCustomer(){if(iInfo.IsManager!=true){if(iInfo.UserType==1){iTip("您无权限进行操作！");return}}if(_Config.MenuCurrentUID==0){iTip("无权限！");return false}var _GUID=_Config.MenuCurrentUID;$.each(CustomerListArr,function(index){if(CustomerListArr[index]==_GUID){iTip("该用户已经是您的客户！");return}});$.get("/handle/SetTempCustomer.asp",{ac:"AddTempCustomer",guid:_GUID,t:GetSendTime()},function(){if(TempCustomerRe==true){CustomerListArr.push(_GUID);try{$("#User_List #"+_GUID).attr("CustomerType","0")}catch(err){}SetCustomerNum();iTip("添加成功！")}else{iTip(TempCustomerRe)}},"script");$("#Y_ManageMenu").hide()}function Send_PrivateApply(){if(iInfo.IsManager!=true){if(iInfo.UserType==1){iTip("您无权限进行操作！");
return}}if(_Config.MenuCurrentUID==0){iTip("无法向游客发送专属申请！");return false}var _GUID=_Config.MenuCurrentUID;var _GNick=_Config.MenuCurrentUname;$.get("/handle/SendPrivateApply.asp",{ac:"SendPrivateApply",guid:_GUID,t:GetSendTime()},function(){if(SendPrivateApplyRe==true){iTip("专属申请发送成功！");var o={};o.Type="CMD_PrivateApply";o.ReceiveRID=iRoomID;o.ReceiveUID=_GUID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);PostMsg(o)}else{iTip(SendPrivateApplyRe)}},"script")}function CheckSpeakPower(){if(iInfo.IsManager==false){if(CheckPowerKeys(iInfo.RoomRolePowerKeys,"2ddf62e5f67685092d02eb4829274776")){try{_Player._LoadMic()}catch(err){}_Config.SpeakPower=true}else{try{_Player._UnLoadMic()}catch(err){}_Config.SpeakPower=false}}}function CheckSpeakPower_UI(){if(iInfo.IsManager==false){if(!CheckPowerKeys(iInfo.RoomRolePowerKeys,"2ddf62e5f67685092d02eb4829274776")){iTip("您没有语音权限！");return false}}return true}function SetMicMuted(){try{_Player._SetMicMuted()}catch(err){}}function FlashSet_MicIsOpen(e){_MicIsOpen=e;if(_Config.TalkType==2){if(_MicIsOpen){LivePublish()}}}function FlashSetTalkType(v){var e=$("#Y_Global_Speak_Model");_Config.TalkType=v;if(v==1){e.attr({t:"1"});e.text("按F2说话")}else{if(v==2){e.attr({t:"2"});e.text("自由发言")}}}function ChangeTalkType(e){_Config.TalkType=e;try{_Player._SetMicConfig("Config_Mic_TalkType",_Config.TalkType)}catch(err){}}function FlashSetMicConfig(e){FlashSetSoundVolume(e.Config_Sound_Volume);FlashSetMicVolume(e.Config_Mic_Volume);FlashSetTalkType(e.Config_Mic_TalkType)}function FlashSetSoundVolume(v){$("#GlobalUsVolume").slider("value",v);var GlobalVolume=$("#Y_Global_Sound_Volume span");v==0?GlobalVolume.addClass("GlobalSilent"):GlobalVolume.removeClass("GlobalSilent");GlobalVolume.attr({oldvolume:_Config.USVolume})}function FlashSetMicVolume(v){$("#GlobalUsMic").slider("value",v);var GlobalMic=$("#Y_Global_Mic_Volume span");v==0?GlobalMic.addClass("GlobalSilent"):GlobalMic.removeClass("GlobalSilent");GlobalMic.attr({oldvolume:_Config.MicGain})
}function SetSoundVolume(e){try{_Player._SetMicConfig("Config_Sound_Volume",e)}catch(err){}}function SetMicVolume(e){try{_Player._SetMicConfig("Config_Mic_Volume",e)}catch(err){}}function OpenMic(){$("#Y_MicPlayer_Div").hasClass("Y_MicPlayer_DivV2")?$("#Y_MicPlayer_Div").removeClass("Y_MicPlayer_DivV2"):$("#Y_MicPlayer_Div").addClass("Y_MicPlayer_DivV2");if(_MicIsOpen){return}try{_Player._OpenMic()}catch(err){}}function FlashSetMicShowTime(e){iInfo.MicShowTime=e;if(e>0){MicTime(null,e)}LivePublish()}function FlashSetIsPublishing(e){iInfo.IsPublishing=e}function UserisManager(){return iInfo.Power>999}function KeyPressHandler(){$(document).keydown(function(e){if(e.which==113){if(_Config.TalkType!=1){return false}if(_Config.KeyDown){return false}_Config.KeyDown=true;try{_Player._F2_OnKeyDown()}catch(err){}}}).keyup(function(e){if(e.which==113){if(_Config.TalkType!=1){return false}_Config.KeyDown=false;try{_Player._F2_OnKeyUp()}catch(err){}}})}function onCuePoint(u,v,t){SoundActivity(u,v);MicTime(u,t)}var MicTimeSetTimeOut=0;function MicTime(u,t){if(t==undefined){return}clearTimeout(MicTimeSetTimeOut);var t=t>0?t:iInfo.MicShowTime;$("#MicListHaveTime").text(t+"s").css({display:t>0?"inline-block":"none"});MicTimeSetTimeOut=setTimeout(function(){$("#MicListHaveTime").css({display:"none"})},1500)}function FLashSetMicActivity(e){$("#Y_Mic_Activity_Display").css({width:e+"%"});SoundActivity(iInfo.UserID,e)}var MicActivityTime=0;function SoundActivity(u,v){clearTimeout(MicActivityTime);try{if(v>3){if($("#"+u+" img:eq(0)").hasClass("On")==false){$("#"+u+" img:eq(0)").addClass("On")}if($("#M"+u+" img:eq(0)").hasClass("On")==false){$("#M"+u+" img:eq(0)").addClass("On")}}else{if($("#"+u+" img:eq(0)").hasClass("On")){$("#"+u+" img:eq(0)").removeClass("On")}if($("#M"+u+" img:eq(0)").hasClass("On")){$("#M"+u+" img:eq(0)").removeClass("On")}}}catch(err){}MicActivityTime=setTimeout(function(){try{$("#"+u+" img:eq(0)").removeClass("On");$("#M"+u+" img:eq(0)").removeClass("On")}catch(err){}},1500)
}function silent(u,v){eval("_Player._ChangeVolume_"+u+"("+v+")")}function ChangeModeType(e){e=parseInt(e);_Config.ModeType=e;var t=$("#ModelButtonList_"+e+" a");$("#ModelButton .Button").text(t.text());if(String(e)=="3"){$("#Y_List").height($(".Y_Left").height()-54-43-$("#Y_Left_Models").height()-160);$("#Y_List>div").height($(".Y_Left").height()-54-43-$("#Y_Left_Models").height()-2);$("#Y_User_List").mCustomScrollbar("update");$("#Y_Friend_List").mCustomScrollbar("update");$("#Y_MicShowList").show()}else{$("#Y_List").height($(".Y_Left").height()-54-43-$("#Y_Left_Models").height()-2);$("#Y_List>div").height($(".Y_Left").height()-54-43-$("#Y_Left_Models").height()-2);$("#Y_User_List").mCustomScrollbar("update");$("#Y_Friend_List").mCustomScrollbar("update");$("#Y_MicShowList").hide()}return;switch(e){case 1:if(_Config.TalkType==2){LivePublish()}break;case 2:if(iInfo.Power<1000){StopPublish()}else{if(_Config.TalkType==2){LivePublish()}}break;case 3:if(iInfo.Power<1000&&iInfo.MicShowTime<1){StopPublish()}else{if(_Config.TalkType==2){LivePublish()}}break}}function ChangeModeType_SetSO(e){try{_Player._ChangeModeType(e)}catch(err){}}function FlashSetChangeStopApply(e){e=Boolean(e);if(e){$("#Mic_Apply").addClass("disEnable");$("#Mic_StopApply").text("开麦")}else{$("#Mic_Apply").removeClass("disEnable");$("#Mic_StopApply").text("禁麦")}_Config.Mic_StopApply=e}function FlashSetChangeMicManage(e){e=Boolean(e);if(e){$("#Mic_Status").addClass("MicStop");$("#Mic_Manage").text("放麦")}else{$("#Mic_Status").removeClass("MicStop");$("#Mic_Manage").text("控麦")}_Config.Mic_Manage=e}function ChangeModeType_PostInfo(e){var o={};o.type="Msg_ChangeModeType";o.ReceiveRID=iInfo.Live_NG_ID;o.ModeType=e;PostMsg(o)}var FaceTemplateStr='<img align="absmiddle" src="/cssimg/face/{0}.gif">';function ReplaceMsgToFace(str){var tstr=str;for(var i=0;i<str.split("/").length;i++){$.each(_FormatStr.FaceArry,function(i,e){if(tstr.indexOf("/"+e)>-1){tstr=tstr.replace("/"+e,$.format(FaceTemplateStr,i))}})}return tstr
}function ReplaceUploadPic(str){var tstr=str;var re=/\[img=([^\]\[]*)\]/ig;var r="";var ismanager=iInfo.Power<1000?"none":"";while(r=re.exec(tstr)){tstr=tstr.replace(r[0],$.format(_FormatStr.MsgSharePic,r[1],ismanager))}return tstr}function MsgPic_LargeZoom(e){$(e).parent().find(".LargeZoom").click()}function Init_MsgSharePic(){$("a.LargeZoom").fancybox({"titleShow":false})}function AddSharePic(e){var NewHtml=$.format(_FormatStr.MsgShareListPic,e.PostUName,e.PicUrl,e.Time,e.SharePicID);$(".Y_SharePic .piclist").prepend(NewHtml);InitSharePic()}function DelSharePic(e){try{$("#SharePic"+e.SharePicID).remove()}catch(err){}}function Set_SharePic(e){if(iInfo.Power<1000){return}var o={};o.Type="CMD_SharePic_Add";o.ReceiveRID=iInfo.Live_NG_ID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.Time=GetSendTime();o.PicUrl=$(e).attr("t");$.get("/handle/SetSharePic.asp",{ac:"SetSharePic",pic:o.PicUrl,rid:iRoomID,t:GetSendTime()},function(){if(SharePicRe){o.SharePicID=SharePicID;PostMsg(o)}},"script")}function SetCurrentLiveUID(e){_Config.CurrentLiveUID=e.UID;_Config.CurrentLiveUName=e.NickName;LiveMessage_getrecord(1)}function LivePublish(){switch(_Config.ModeType){case 1:break;case 2:if(iInfo.Power<1000){StopPublish();return}break;case 3:if(iInfo.Power<1000&&iInfo.MicShowTime<1){StopPublish();return}break}if(!_MicIsOpen){$("#Y_MicPlayer_Div").hasClass("Y_MicPlayer_DivV2")?"":$("#Y_MicPlayer_Div").addClass("Y_MicPlayer_DivV2");try{_Player._OpenMic()}catch(err){}return}if(!iInfo.IsPublishing){try{_Player._LivePublish()}catch(err){}iInfo.IsPublishing=true}}function StopPublish(){if(_Config.TalkType==2){if(UserisManager()==true){return}}try{_Player._StopPublish()}catch(err){}iInfo.IsPublishing=false}function SetToPerson(e){if(e.uid==0){_Config.PrivateChecked=false}_Config.ToPersonUID=e.uid;_Config.ToPersonUName=e.uname;_Config.ToPersonPower=e.power;_Config.ToPersonRoleStyle=e.RoleStyle;_Config.ToPersonRoleTitle=e.RoleTitle;_Config.ToPersonZberStyle=e.ZberStyle;
_Config.ToPersonRoomRoleStyle=e.RoomRoleStyle;_Config.ToPersonRoomRoleTitle=e.RoomRoleTitle}function SetPrivatePopToPerson(e){_Config.PrivatePop_ToPersonUID=e.uid;_Config.PrivatePop_ToPersonUName=e.uname;_Config.PrivatePop_ToPersonPower=e.power;_Config.PrivatePop_ToPersonRoleStyle=e.RoleStyle;_Config.PrivatePop_ToPersonRoleTitle=e.RoleTitle;_Config.PrivatePop_ToPersonZberStyle=e.ZberStyle;_Config.PrivatePop_ToPersonRoomRoleStyle=e.RoomRoleStyle;_Config.PrivatePop_ToPersonRoomRoleTitle=e.RoomRoleTitle}function CheckMsgLength(e){if(e.Msg.length>_Config.MsgMaxNum){return true}}function AutoPostMsg(e){if($.cookie("Silent_"+iRoomID)){if(new Date().format("yyyy-MM-dd hh:mm:ss").localeCompare($.cookie("Silent_"+iRoomID))==-1){iTip("您被"+iRoomID+"房间管理员禁言到"+$.cookie("Silent_"+iRoomID));return false}}if($("#Y_iSend_Private").hasClass("PrivateMsgChecked")){PostMsg_Private(e)}else{PostMsg_Public(e)}return false}function PostMsg_Public(e){if(_SysConfig.CheckMsg==1){var o={};o.Type="Msg_Public";o.ReceiveRID=iInfo.Live_NG_ID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.PostPower=iInfo.Power;o.ReceiveUID=_Config.ToPersonUID;o.ReceiveUName=_Config.ToPersonUName;o.ReceivePower=_Config.ToPersonPower;o.RoleStyle=iInfo.RoleCssStyle;o.ZberStyle=iInfo.IsZber?"RoomBo":"";o.RoomRoleStyle=iInfo.RoomRoleStyle;o.RoomRoleTitle=GB2312UnicodeConverter.ToUnicode(iInfo.RoomRoleTitle);o.Receive_RoleStyle=_Config.ToPersonRoleStyle;o.Receive_ZberStyle=_Config.ToPersonZberStyle;o.Receive_RoomRoleStyle=_Config.ToPersonRoomRoleStyle;o.Receive_RoomRoleTitle=GB2312UnicodeConverter.ToUnicode(_Config.ToPersonRoomRoleTitle);o.PostRoleTitle=iInfo.RoleName;o.ReceiveRoleTitle=_Config.ToPersonRoleTitle;o.MID=guidGenerator();o.isSelf=false;o.Time=GetSendTime();o.Msg=$(e).val().split("@").join("");o.MD5="";o.Checked=iInfo.IsManager?true:false;$(e).val("");$(e).focus();if(CheckMsgLength(o)){iTip("消息字数最多"+_Config.MsgMaxNum+"个。");return}if(_SysConfig.SaveMsg==1){if(iInfo.IsLogin==false&&_SysConfig.SaveGuestMsg==0){o.MD5=hex_md5(getDataTimes());
PostMsg(o)}else{$.get("/Handle/AddChatMsg.asp",{ac:"AddChatMsg",Type:0,Roomid:iRoomID,UID:o.PostUID,UName:o.PostUName,GUID:o.ReceiveUID?o.ReceiveUID:0,GUName:o.ReceiveUName,ChatMsg:o.Msg,t:getDataTimes()},function(json){var dataObj=eval("("+json+")");$.each(dataObj.data,function(i,c){o.MD5=c.MD5;PostMsg(o)})},"script")}}else{o.MD5=guidGenerator();PostMsg(o)}if(_SysConfig.ShowMyMsg==1&&iInfo.IsManager==false){var c={};c=$.extend(true,{},o);c.isSelf=true;ReceiveInfo(c)}}else{var o={};o.Type="Msg_Public";o.ReceiveRID=iInfo.Live_NG_ID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.PostPower=iInfo.Power;o.ReceiveUID=_Config.ToPersonUID;o.ReceiveUName=_Config.ToPersonUName;o.ReceivePower=_Config.ToPersonPower;o.RoleStyle=iInfo.RoleCssStyle;o.ZberStyle=iInfo.IsZber?"RoomBo":"";o.RoomRoleStyle=iInfo.RoomRoleStyle;o.RoomRoleTitle=GB2312UnicodeConverter.ToUnicode(iInfo.RoomRoleTitle);o.Receive_RoleStyle=_Config.ToPersonRoleStyle;o.Receive_ZberStyle=_Config.ToPersonZberStyle;o.Receive_RoomRoleStyle=_Config.ToPersonRoomRoleStyle;o.Receive_RoomRoleTitle=GB2312UnicodeConverter.ToUnicode(_Config.ToPersonRoomRoleTitle);o.PostRoleTitle=iInfo.RoleName;o.ReceiveRoleTitle=_Config.ToPersonRoleTitle;o.Time=GetSendTime();o.Msg=$(e).val().split("@").join("");o.MD5="";o.Checked=true;$(e).val("");$(e).focus();if(CheckMsgLength(o)){iTip("消息字数最多"+_Config.MsgMaxNum+"个。");return}PostMsg(o);if(_SysConfig.SaveMsg==1){if(iInfo.IsLogin==false&&_SysConfig.SaveGuestMsg==0){return}$.get("/Handle/AddChatMsg.asp",{ac:"AddChatMsg",Type:0,Roomid:iRoomID,UID:o.PostUID,UName:o.PostUName,GUID:o.ReceiveUID?o.ReceiveUID:0,GUName:o.ReceiveUName,ChatMsg:o.Msg,t:getDataTimes()},function(){},"script")}}}function PostMsg_Private(e){var o={};o.Type="Msg_Private";o.ReceiveRID=iRoomID;o.PostUID=iInfo.UserID;o.PostUName=GB2312UnicodeConverter.ToUnicode(iInfo.UserNickName);o.PostPower=iInfo.Power;o.ReceiveUID=_Config.ToPersonUID;o.ReceiveUName=_Config.ToPersonUName;o.ReceivePower=_Config.ToPersonPower;
o.RoleStyle=iInfo.RoleCssStyle;o.ZberStyle=iInfo.IsZber?"RoomBo":"";o.RoomRoleStyle=iInfo.RoomRoleStyle;o.RoomRoleTitle=GB2312UnicodeConverter.ToUnicode(iInfo.RoomRoleTitle);o.Receive_RoleStyle=_Config.ToPersonRoleStyle;o.Receive_ZberStyle=_Config.ToPersonZberStyle;o.Receive_RoomRoleStyle=_Config.ToPersonRoomRoleStyle;o.Receive_RoomRoleTitle=GB2312UnicodeConverter.ToUnicode(_Config.ToPersonRoomRoleTitle);o.Time=GetSendTime();o.Msg=$(e).val().split("@").join("");$(e).val("");$(e).focus();if(CheckMsgLength(o)){iTip("消息字数最多"+_Config.MsgMaxNum+"个。");return}PostMsg(o);$.get("/Handle/AddChatMsg.asp",{ac:"AddChatMsg",Type:1,Roomid:iRoomID,UID:o.PostUID,UName:o.PostUName,GUID:o.ReceiveUID,GUName:o.ReceiveUName,ChatMsg:o.Msg,t:getDataTimes()},function(){},"script")}function PostMsg(e){if(Is_WS==true){WS_PostInfo(e)}else{_Player._PostInfo(e)}}function ReceiveInfo(e){setTimeout(function(){var c={};c=$.extend(true,{},e);var FormatStr,ControlStr,Control,NewMsgHtml,UlMaxNum,AutoRoll;switch(e.Type){case"Msg_Public":if(InBlackList(e.PostUID)){return}FormatStr=e.ReceiveUID==0?_FormatStr.PublicMsg:_FormatStr.PublicMsg_ToPerson;if(_SysConfig.CheckMsg==1){if(e.Checked==false){if(iInfo.IsManager){FormatStr=e.ReceiveUID==0?_FormatStr.PublicMsg_Check:_FormatStr.PublicMsg_ToPerson_Check;_CheckMsgList[c.MD5]=c}else{if(e.isSelf!=true){return}}}else{if(iInfo.IsManager){if(e.IsDBMsg==false){if(e.MD5!=""){$("#"+e.MD5).hide()}return}}}}else{}if(typeof(e.MID)!="undefined"){if($("#Y_PubMes_Div ul li[MID='"+e.MID+"']").length>0){return}}if(e.MD5!=""){if($("#M_"+e.MD5).length>0){}}e.Msg=GB2312UnicodeConverter.ToGB2312(unescape(unescape(e.Msg)));e.Msg=ReplaceKeys(e.Msg);e.Msg=ReplaceMsgToFace(e.Msg);e.Msg=ReplaceUploadPic(e.Msg);e.PostUID=ReplaceKeys_UID(e.PostUID);UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,e.PostUID,GB2312UnicodeConverter.ToGB2312(unescape(e.PostUName)),e.ReceiveUID,GB2312UnicodeConverter.ToGB2312(unescape(unescape(e.ReceiveUName))),e.Msg,e.Time,e.MD5,e.Checked,e.PostPower,e.ReceivePower,e.RoleStyle,e.ZberStyle,e.RoomRoleStyle,unescape(unescape(e.RoomRoleTitle)),e.Receive_RoleStyle,e.Receive_ZberStyle,e.Receive_RoomRoleStyle,unescape(e.Receive_RoomRoleTitle),e.PostPower>=1000?"RoomManager":"",e.ReceivePower>=1000?"RoomManager":"",e.MID,unescape(unescape(e.PostRoleTitle)),unescape(unescape(e.ReceiveRoleTitle)));
break;case"Msg_Private":if(InBlackList(e.PostUID)){return}if(iInfo.UserID!=e.PostUID&&iInfo.UserID!=e.ReceiveUID){return}FormatStr=_FormatStr.PrivateMsg_ToPerson;e.Msg=unescape(e.Msg);e.Msg=ReplaceKeys(e.Msg);e.Msg=ReplaceMsgToFace(e.Msg);e.Msg=ReplaceUploadPic(e.Msg);e.PostUID=ReplaceKeys_UID(e.PostUID);UlMaxNum=10;AutoRoll=_Config.Pri_isScroll;ControlStr="#Y_PriMes_Div";NewMsgHtml=$.format(FormatStr,e.PostUID,unescape(e.PostUName),e.ReceiveUID,unescape(e.ReceiveUName),e.Msg,e.Time,e.PostPower,e.ReceivePower,"","",e.RoleStyle,e.ZberStyle,e.RoomRoleStyle,unescape(e.RoomRoleTitle),e.Receive_RoleStyle,e.Receive_ZberStyle,e.Receive_RoomRoleStyle,unescape(e.Receive_RoomRoleTitle),e.PostPower>=1000?"RoomManager":"",e.ReceivePower>=1000?"RoomManager":"");break;case"Msg_Private_Pop":if(InBlackList(e.PostUID)){return false}if(iInfo.UserID!=e.PostUID&&iInfo.UserID!=e.ReceiveUID){return false}if(iInfo.UserID==e.PostUID){if(typeof(e.isSelf)!="undefined"){if(e.isSelf!=true){return false}}}if(iInfo.UserID==e.ReceiveUID){Sale_PrivatePop_Add_ByObj(e)}FormatStr=_FormatStr.PublicMsg;e.Msg=unescape(unescape(e.Msg));e.Msg=ReplaceKeys(e.Msg);e.Msg=ReplaceMsgToFace(e.Msg);e.Msg=ReplaceUploadPic(e.Msg);e.PostUID=ReplaceKeys_UID(e.PostUID);UlMaxNum=100;AutoRoll=true;ControlStr="#PrivatePop_MsgList_"+(iInfo.UserID==e.PostUID?e.ReceiveUID:e.PostUID);NewMsgHtml=$.format(FormatStr,e.PostUID,GB2312UnicodeConverter.ToGB2312(unescape(e.PostUName)),e.ReceiveUID,GB2312UnicodeConverter.ToGB2312(unescape(unescape(e.ReceiveUName))),e.Msg,e.Time,e.MD5,e.Checked,e.PostPower,e.ReceivePower,e.RoleStyle,e.ZberStyle,e.RoomRoleStyle,unescape(unescape(e.RoomRoleTitle)),e.Receive_RoleStyle,e.Receive_ZberStyle,e.Receive_RoomRoleStyle,unescape(e.Receive_RoomRoleTitle),e.PostPower>=1000?"RoomManager":"",e.ReceivePower>=1000?"RoomManager":"",e.MID,unescape(unescape(e.PostRoleTitle)),unescape(unescape(e.ReceiveRoleTitle)));break;case"Sys_Public":FormatStr=_FormatStr.SysMsg;e.Msg=unescape(e.Msg);e.Msg=ReplaceMsgToFace(e.Msg);
e.Msg=ReplaceUploadPic(e.Msg);UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,e.Msg,GetSendTime());break;case"Sys_Private":FormatStr=_FormatStr.SysMsg;e.Msg=unescape(e.Msg);e.Msg=ReplaceMsgToFace(e.Msg);e.Msg=ReplaceUploadPic(e.Msg);UlMaxNum=10;AutoRoll=_Config.Pri_isScroll;ControlStr="#Y_PriMes_Div";NewMsgHtml=$.format(FormatStr,e.Msg,GetSendTime());break;case"Enter_Msg":FormatStr=_FormatStr.EnterMsg;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";e.PostUID=ReplaceKeys_UID(e.PostUID);NewMsgHtml=$.format(FormatStr,e.PostUID,unescape(e.PostUName),GetSendTime());break;case"Fly_Msg":PlySwf.show();e.Msg=unescape(e.Msg);for(var i=0;i<e.Msg.length;i++){e.Msg=ReplaceKeys(removeHTMLTag(e.Msg))}_iFlyMsgPlayer.jsExec(unescape(unescape(e.PostUName))+"："+unescape(unescape(e.Msg)),36);return;break;case"Msg_SendGift":FormatStr=_FormatStr.SendGiftMsg;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";e.PostUID=ReplaceKeys_UID(e.PostUID);NewMsgHtml=$.format(FormatStr,e.PostUID,GB2312UnicodeConverter.ToGB2312(unescape(e.PostUName)),e.PostPower,unescape(unescape(e.PostRoleTitle)),e.RoleStyle,e.ZberStyle,e.RoomRoleStyle,unescape(unescape(e.RoomRoleTitle)),e.ReceiveUID,GB2312UnicodeConverter.ToGB2312(unescape(unescape(e.ReceiveUName))),e.ReceivePower,unescape(unescape(e.ReceiveRoleTitle)),e.Receive_RoleStyle,e.Receive_ZberStyle,unescape(e.Receive_RoomRoleTitle),e.Receive_RoomRoleStyle,e.PostPower>=1000?"RoomManager":"",e.ReceivePower>=1000?"RoomManager":"",e.Gift_Icon,e.Gift_Pic,e.Gift_Num,e.Gift_Price);break;case"Manage_Kick":if(e.ReceiveUID==iInfo.UserID){$.cookie("Kick_"+iRoomID,GetNewTime(60),{path:"/",expires:365});location.href="/Error.shtml?"+escape("您被管理员踢出 1 小时，截止到"+$.cookie("Kick_"+iRoomID));return}else{if(_SysConfig.ShowManageMsg==0){if(e.ReceiveUID!=iInfo.UserID||e.PostUID!=iInfo.UserID){return}}FormatStr=_FormatStr.KickMsg;
UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,unescape(unescape(e.PostUName)),unescape(unescape(e.ReceiveUName)),GetSendTime())}break;case"Manage_BlackKick":if(e.ReceiveUID==iInfo.UserID){$.get("/handle/SetBlackKick.asp",{ac:"SetBlackKick",rid:iRoomID,t:GetSendTime()},function(){location.href="/Error.shtml?"+escape("您被管理员踢出并列入黑名单，解封请联系管理人员。")});return}else{if(_SysConfig.ShowManageMsg==0){if(e.ReceiveUID!=iInfo.UserID||e.PostUID!=iInfo.UserID){return}}FormatStr=_FormatStr.BlackKickMsg;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,unescape(unescape(e.PostUName)),unescape(unescape(e.ReceiveUName)),GetSendTime())}break;case"Manage_Silent":if(e.ReceiveUID==iInfo.UserID){$.cookie("Silent_"+iRoomID,GetNewTime(5),{path:"/",expires:365})}if(_SysConfig.ShowManageMsg==0){if(e.ReceiveUID!=iInfo.UserID||e.PostUID!=iInfo.UserID){return}}FormatStr=_FormatStr.SilentMsg;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,unescape(e.PostUName),unescape(e.ReceiveUName),GetSendTime());break;case"Manage_UnSilent":if(e.ReceiveUID==iInfo.UserID){$.cookie("Silent_"+iRoomID,GetNewTime(0),{path:"/",expires:365})}if(_SysConfig.ShowManageMsg==0){if(e.ReceiveUID!=iInfo.UserID||e.PostUID!=iInfo.UserID){return}}FormatStr=_FormatStr.UnSilentMsg;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,unescape(e.PostUName),unescape(e.ReceiveUName),GetSendTime());break;case"Manage_Manager":if(_SysConfig.ShowManageMsg==0){if(e.ReceiveUID!=iInfo.UserID||e.PostUID!=iInfo.UserID){return}}FormatStr=_FormatStr.ManagerMsg;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,unescape(e.PostUName),unescape(e.ReceiveUName),GetSendTime());break;case"Manage_UnManager":if(_SysConfig.ShowManageMsg==0){if(e.ReceiveUID!=iInfo.UserID||e.PostUID!=iInfo.UserID){return
}}FormatStr=_FormatStr.UnManagerMsg;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,unescape(e.PostUName),unescape(e.ReceiveUName),GetSendTime());break;case"Manage_SetRoomUserRole":SetRoomUserRole(e);break;case"Menu_Black":FormatStr=_FormatStr.BlackMsg;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,unescape(e.ReceiveUName),GetSendTime());break;case"Menu_UnBlack":FormatStr=_FormatStr.UnBlackMsg;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";NewMsgHtml=$.format(FormatStr,unescape(e.ReceiveUName),GetSendTime());break;case"Msg_Del":$("#M_"+e.MD5).remove();return;break;case"CMD_SendRedBag":AddRegBagNum();FormatStr=_FormatStr.RedBad;UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PubMes_Div";e.PostUID=ReplaceKeys_UID(e.PostUID);NewMsgHtml=$.format(FormatStr,e.PostUID,GB2312UnicodeConverter.ToGB2312(unescape(e.PostUName)),e.ReceiveUID,GB2312UnicodeConverter.ToGB2312(unescape(e.ReceiveUName)),e.Msg,e.Time,e.MD5,e.Checked,e.PostPower,e.ReceivePower,e.RoleStyle,e.ZberStyle,e.RoomRoleStyle,unescape(unescape(e.RoomRoleTitle)),e.Receive_RoleStyle,e.Receive_ZberStyle,e.Receive_RoomRoleStyle,unescape(e.Receive_RoomRoleTitle),e.PostPower>=1000?"RoomManager":"",e.ReceivePower>=1000?"RoomManager":"",unescape(unescape(e.PostRoleTitle)),unescape(unescape(e.ReceiveRoleTitle)));break;case"CMD_SharePic_Add":AddSharePic(e);return;break;case"CMD_SharePic_Del":DelSharePic(e);return;break;case"CMD_Shouted_Update":AjaxSetShouted();return;break;case"CMD_ViewPoint_Add":AddViewPoint(e);FormatStr=_FormatStr.PublicMsg_ViewPoint;e.Msg=unescape(e.Msg);e.Msg=ReplaceKeys(e.Msg);e.Msg=ReplaceMsgToFace(e.Msg);e.Msg=ReplaceUploadPic(e.Msg);e.PostUID=ReplaceKeys_UID(e.PostUID);UlMaxNum=_Config.PublicMsgMaxNum;AutoRoll=_Config.Pub_isScroll;ControlStr="#Y_PriMes_Div";NewMsgHtml=$.format(FormatStr,e.PostUID,unescape(e.PostUName),e.ReceiveUID,unescape(e.ReceiveUName),unescape(e.Msg),e.Time,e.MD5,e.Checked,e.PostPower,e.ReceivePower,e.RoleStyle,e.ZberStyle,e.RoomRoleStyle,unescape(e.RoomRoleTitle),e.Receive_RoleStyle,e.Receive_ZberStyle,e.Receive_RoomRoleStyle,unescape(e.Receive_RoomRoleTitle),e.PostPower>=1000?"RoomManager":"",e.ReceivePower>=1000?"RoomManager":"",unescape(unescape(e.PostRoleTitle)),unescape(unescape(e.ReceiveRoleTitle)));
break;case"CMD_ViewPoint_Del":DelViewPoint(e);return;break;case"CMD_MsgCheckMode_Change":MsgCheckMode_Change(e);return;break;case"CMD_RollOut":setTimeout(function(){location.href="/"+e.RollOutRoomID},1000);return;break;case"CMD_LiveCast":LiveCast_Do(e.LiveCastRoomID);return;break;case"CMD_LiveCast_End":LiveCast_End();return;break;case"CMD_LiveCast_YY":LiveCast_Do_YY(e.YYID);return;break;case"CMD_LiveCast_End_YY":LiveCast_End_YY();return;break;case"CMD_LiveCast_Other":LiveCast_Do_Other(e.RID,e.SN,e.Msg,e.Watch);return;break;case"CMD_LiveCast_End_Other":LiveCast_End_Other();return;break;case"CMD_CurrentLive":SetCurrentLiveUID(e);_Config.Room_LiveWapUrl=e.WapPubName;if(ibrowser.mobile==true){if($("#i_Live_Player").attr("t")!="pub"){_Dis_Live(0)}}return;break;case"CMD_LiveMessageUpdate":LiveMessage_getrecord(1);return;break;case"CMD_Position":Position_Do(e);return;break;case"CMD_VoteUpdate":Vote_Do(e);return;break;case"CMD_Vote_Start":Start_Vote();return;break;case"CMD_Vote_Stop":Stop_Vote();return;break;case"CMD_GetQQ":if(e.ReceiveUID==iInfo.UserID){GetQQ(e)}return;break;case"CMD_GetQQ_CallBack":if(e.ReceiveUID==iInfo.UserID){GetQQ_CallBack(e)}return;break;case"CMD_PrivateApply":if(e.ReceiveUID==iInfo.UserID){Show_PrivateApply(e)}return;break;case"CMD_PrivateApply_True":if(e.ReceiveUID==iInfo.UserID){var o={};o.Type="Sys_Private";o.ReceiveRID=iRoomID;o.PostUID=e.PostUID;o.PostUID=ReplaceKeys_UID(o.PostUID);o.PostUName=e.PostUName;o.Msg="<a uname='"+o.PostUName+"' uid='"+o.PostUID+"' class='u' href='javascript://' onclick='LinkLayerClick(this)'>"+o.PostUName+" </a> 已经成为您的专属用户。";ReceiveInfo(o)}return;break;case"CMD_PrivateApply_False":if(e.ReceiveUID==iInfo.UserID){var o={};o.Type="Sys_Private";o.ReceiveRID=iRoomID;o.PostUID=e.PostUID;o.PostUID=ReplaceKeys_UID(o.PostUID);o.PostUName=e.PostUName;o.Msg="<a uname='"+o.PostUName+"' uid='"+o.PostUID+"' class='u' href='javascript://' onclick='LinkLayerClick(this)'>"+o.PostUName+" </a> 拒绝了您的专属请求。";ReceiveInfo(o)}return;break;case"CMD_Quotation":UpdateQuotation(e);
return;break;
case "QuickReply_Msg":	
			FormatStr = _FormatStr.QuickReplyMsg;
			UlMaxNum = _Config.PublicMsgMaxNum;
			AutoRoll = _Config.Pub_isScroll;
			ControlStr = '#Y_PubMes_Div';
			e.Msg = unescape(unescape(e.Msg));
			e.Msg = ReplaceMsgToFace(e.Msg);
			e.Msg = ReplaceUploadPic(e.Msg);				
			e.PostUName = unescape(e.PostUName);						
			NewMsgHtml = $.format(FormatStr,unescape(e.PostUName),e.Msg,GetSendTime(),unescape(e.RoleID));				
			break;
}Control=$(ControlStr);var ControlUl=Control.find("ul");if(AutoRoll&&ControlUl[0].childNodes.length>UlMaxNum){for(i=0;i<(ControlUl[0].childNodes.length-UlMaxNum);i++){ControlUl[0].removeChild(ControlUl[0].firstChild)}}ControlUl.append(NewMsgHtml);Control.mCustomScrollbar("update");AutoRoll?Control.mCustomScrollbar("scrollTo","bottom"):"";Init_MsgSharePic()},10)}function CheckMsg_True(MD5,e){if(!iInfo.IsManager){location.href="/Fail.shtml?"+escape("非法请求")}$(e).hide();var o={};o=_CheckMsgList[MD5];o.ReceiveRID=iInfo.Live_NG_ID;o.Checked=true;o.IsDBMsg=false;o.MD5=MD5;PostMsg(o);$.get("/Handle/UpdateChatMsg.asp",{ac:"UpdateChatMsg",rid:iRoomID,"MD5":o.MD5},function(){},"script")}function DelMsg(MD5){if(!iInfo.IsManager){location.href="/Fail.shtml?"+escape("非法请求")}$("#M_"+MD5).remove();var o={};o.Type="Msg_Del";o.ReceiveRID=iInfo.Live_NG_ID;o.MD5=MD5;PostMsg(o);$.get("/Handle/UpdateChatMsg.asp",{ac:"DelChatMsg",rid:iRoomID,"MD5":MD5},function(){},"script")}function MsgCheckMode_Change(e){if(e.Mode==2){_SysConfig.CheckMsg=_SysConfig.GlobalCheckMsg}else{_SysConfig.CheckMsg=e.Mode}}function MsgScrollToBottom(){_Config.Pub_isScroll?$("#Y_PubMes_Div").mCustomScrollbar("scrollTo","bottom"):""}function ManyWindowError(){iTip("您同一房间打开了过多窗口！当前页面自动跳转到首页！",null,30000);location.href="/"}function DisLive(){var strtime=getDataTimes();var swfVersionStr="11.1.0";var xiSwfUrlStr="/swf/playerProductInstall.swf";var flashvars={};var params={};params.quality="high";params.wmode="transparent";var u=navigator.userAgent;if(u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||(u.indexOf("Android")>-1||u.indexOf("Linux")>-1)){params.wmode="Window"}params.bgcolor="#000000";params.allowscriptaccess="sameDomain";params.allowfullscreen="true";var attributes={};attributes.id=_Config.PlayerID;attributes.name=_Config.PlayerID;attributes.align="middle";var RoomSoundConfig_Str="";if(RoomConfig.RtmpUrl){RoomSoundConfig_Str=RoomSoundConfig_Str+"&RtmpUrl="+RoomConfig.RtmpUrl}if(RoomConfig.MsgUrl){RoomSoundConfig_Str=RoomSoundConfig_Str+"&MsgUrl="+RoomConfig.MsgUrl
}if(RoomConfig.Rate!=0){RoomSoundConfig_Str=RoomSoundConfig_Str+"&Rate="+RoomConfig.Rate}swfobject.embedSWF("/swf/Sound.swf?RoomID="+iRoomID+RoomSoundConfig_Str,_Config.BindPlayerID,"250","205",swfVersionStr,xiSwfUrlStr,flashvars,params,attributes)}function DisBell(){var strtime=getDataTimes();var swfVersionStr="11.1.0";var xiSwfUrlStr="/swf/playerProductInstall.swf";var flashvars={};var params={};params.quality="high";params.wmode="transparent";var u=navigator.userAgent;if(u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)||(u.indexOf("Android")>-1||u.indexOf("Linux")>-1)){params.wmode="Window"}params.bgcolor="#000000";params.allowscriptaccess="sameDomain";params.allowfullscreen="true";var attributes={};attributes.id=_Config.BellPlayerID;attributes.name=_Config.BellPlayerID;attributes.align="middle";var RoomSoundConfig_Str="";swfobject.embedSWF("/swf/Bell.swf",_Config.BindBellPlayerID,"1","1",swfVersionStr,xiSwfUrlStr,flashvars,params,attributes)}function GetChatMsg(pageindex){$.get("/Handle/GetChatMsg.asp",{ac:"GetChatMsg",page:pageindex,Roomid:iRoomID,t:getDataTimes},function(json){var dataObj=eval("("+json+")");$.each(dataObj.data,function(i,e){ReceiveInfo(e)})},"script")}function GetOnlineUsers(){$.get("/Handle/GetRoomOnlineUser.asp",{ac:"GetRoomOnlineUser",RID:iRoomID,t:getDataTimes},function(json){FixMsgInfo("UL_Cache",json)})}$(function(){$("#ModelButton .Button").text($("#ModelButtonList_"+_Config.ModeType+" a").text());if($.cookie("Kick_"+iRoomID)){if(new Date().format("yyyy-MM-dd hh:mm:ss").localeCompare($.cookie("Kick_"+iRoomID))==-1){location.href="/Kick.html?"+"您被管理员踢出 1 小时，截止到"+$.cookie("Kick_"+iRoomID)}}EnterRoom(iInfo);GetOnlineUsers();GetChatMsg(1)});

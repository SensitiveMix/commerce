/*! live-0.0.0.js 2016-06-03 */
!(function () { var a = document, b = window, c = (parseInt, a.documentElement), d = a.body, e = a.compatMode == 'CSS1Compat', f = e ? c : d; encodeURIComponent; b.CHAT = {msgObj: a.getElementById('message'), screenheight: b.innerHeight ? b.innerHeight : f.clientHeight, username: null, userid: null, socket: null, level: null, scrollToBottom: function () { b.scrollTo(0, this.msgObj.clientHeight) }, logout: function () { location.reload() }, submit: function () { var b = a.getElementById('Y_iSend_Input').value; if (b != '') { var c = {userid: this.userid, username: this.username, content: b, level: this.level}; this.socket.emit('message', c), a.getElementById('Y_iSend_Input').value = '' } return !1 }, genUid: function () { return (new Date()).getTime() + '' + Math.floor(899 * Math.random() + 100) }, updateSysMsg: function (b, c) { var d = b.onlineUsers, e = (b.onlineCount, b.user, ''); for (key in d)d.hasOwnProperty(key) && (e += '<li><div class="UBase"><img class="USoundStatus" src="/images/pixel.gif"><img class="US_Pic" src="/images/201509070905306991.jpg"><span title="" class="UName" href="javascript:void(0)">' + d[key].nick_name + '</span><img class="RoomUserRole RoomUser2" title="普通客户：可文字发言" src="/images/' + d[key].level + '.png"></div></li>'); $('#User_List').html(e); var f = ''; f += '<span class="f">', f += this.username, f += c == 'login' ? ' 加入了聊天室' : ' 退出了聊天室', f += '</span>'; var g = a.createElement('li'); g.className = 'system J-mjrlinkWrap J-cutMsg', g.innerHTML = f, this.msgObj.appendChild(g), this.scrollToBottom() }, usernameSubmit: function () { var a = this.genUid(); return a != '' && this.init(a), !1 }, init: function (b) { this.userid = this.genUid(), this.username = $('#regBt span').text(), this.level = $('#userlevel').val(), this.scrollToBottom(), this.socket = io.connect('ws://localhost:3000'), this.socket.emit('login', {userid: this.userid, nick_name: this.username, level: this.level}), this.socket.on('login', function (a) { CHAT.updateSysMsg(a, 'login') }), this.socket.on('logout', function (a) { CHAT.updateSysMsg(a, 'logout') }), this.socket.on('message', function (b) { var c = new Date(), d = b.userid == CHAT.userid, e = '<span class="t">' + c.getHours() + ':' + c.getMinutes() + '</span>', f = '<img class="Role Manager2" src="/images/' + b.level + '.png" title="频道管理">', g = '<a class="u">' + b.username + '：</a>', h = '<span class="m">' + b.content + '</span>', i = a.createElement('li'); d ? (i.className = 'user', i.innerHTML = e + f + g + h) : (i.className = 'service', i.innerHTML = e + f + g + h), CHAT.msgObj.appendChild(i), $('#Y_PubMes_Div').mCustomScrollbar('update'), $('#Y_PubMes_Div').mCustomScrollbar('scrollTo', 'last') }) }}, a.getElementById('Y_iSend_Input').onkeydown = function (a) { a = a || event, a.keyCode === 13 && CHAT.submit() } }())

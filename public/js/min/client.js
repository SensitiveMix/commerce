/*! live-0.0.0.js 2016-07-19 */
!(function () { var a = document, b = window, c = (parseInt, a.documentElement), d = a.body, e = a.compatMode == 'CSS1Compat', f = e ? c : d; encodeURIComponent; b.CHAT = {msgObj: a.getElementById('message'), screenheight: b.innerHeight ? b.innerHeight : f.clientHeight, username: null, userid: null, socket: null, level: null, belong: null, ubelong: null, ip: null, level_name: null, name: null, account: null, logout: function () { location.reload() }, submit: function (b) { var c = a.getElementById('Y_iSend_Input').value; if (c == '' && b != 'flower') return alert('发送内容不能为空！'), !1; var d = new Date(), e = d.getFullYear() + '年-' + (d.getMonth() + 1) + '月' + d.getDate() + '日' + d.getHours() + ':' + d.getMinutes(), f = Date.now() + 288e5; if (c != '' || b != '') { var g = null; this.level != 66 && (g = this.ubelong); var h = {userid: this.userid, username: this.username, content: c, sendto: null, sendtoname: null, level: this.level, belong: this.belong, ubelong: g, ip: this.ip, time: f, type: null, sendtime: e}; CHAT.level == 66 && (h.sendto = $('#sel').find('option:selected').val(), h.sendtoname = $('#sel').find('option:selected').text()), b == 'flower' && (h.type = 'flower'), this.socket.emit('message', h), a.getElementById('Y_iSend_Input').value = '' } return !1 }, genUid: function () { return (new Date()).getTime() + '' + Math.floor(899 * Math.random() + 100) }, updateSysMsg: function (b, c) { var d = b.onlineUsers, e = (b.onlineCount, b.user, ''), f = '<option value="all">所有人</option>'; a.createElement('option'); for (key in d)d.hasOwnProperty(key) && (CHAT.level == 66 && d[key].belong == CHAT.userid && (e += '<li><a><img width="25px" src="/images/' + d[key].level + '.png"/><span>' + d[key].nick_name + '</span></a></li>'), d[key].nick_name != CHAT.username && CHAT.level == 66 && d[key].belong == CHAT.userid && (f += '<option value=' + d[key].userid + '>' + d[key].nick_name + '</option>')); CHAT.level == 66 && $('#User_List').html(e); var g = ''; g += '<li class="chatli"><span class="b">', g += b.user.nick_name, g += c == 'login' ? ' 加入了聊天室' : ' 退出了聊天室', g += '</span></li>'; var h = a.createElement('li'); h.className = 'system J-mjrlinkWrap J-cutMsg', $(h).html(g), CHAT.level == 66 && b.user.belong == CHAT.userid && this.msgObj.appendChild(h) }, usernameSubmit: function () { var a = this.genUid(); return a != '' && this.init(a), !1 }, biaoqing: function (a) { return a = a.replace(/\</g, '&lt;'), a = a.replace(/\>/g, '&gt;'), a = a.replace(/\n/g, '<br/>'), a = a.replace(/\[em_([0-9]*)\]/g, '<img src="/face/$1.gif" border="0" />') }, init: function (b) { this.userid = $('#userid').val(), this.username = $('#nicknamei').html(), this.level = $('#userlevel').val(), this.belong = $('#belong').val(), this.ubelong = $('#ubelong_name').val(), this.ip = $('#ip').val(), this.level_name = $('#level_name').val(), this.name = $('#name').val(), this.account = $('#account').val(), this.socket = io.connect('ws://139.196.164.208:3000'); var c = Math.floor(1500 * Math.random()), d = new Date(), e = d.getFullYear() + '年' + (d.getMonth() + 1) + '月' + d.getDate() + '日' + d.getHours() + ':' + d.getMinutes(); this.socket.emit('login', {_id: this.userid, name: this.name, nick_name: this.username, level: this.level, belong: this.belong, ubelong: this.level == 66 ? null : this.ubelong, ip: this.ip, account: this.account, random_id: c, login_start: e, level_name: this.level_name}), this.socket.on('login', function (a) { CHAT.updateSysMsg(a, 'login') }), this.socket.on('logout', function (a) { CHAT.updateSysMsg(a, 'logout') }), this.socket.on('fabugonggao', function (a) { $('#gonggao').html(a.gonggao), $('#gundongspan').html(a.gonggao) }), this.socket.on('fabuhandan', function (a) { $('#dkqs').html(a.dkqs), $('#kcdw').html(a.kcdw), $('#pcdw').html(a.pcdw), $('#zsdw').html(a.zsdw), $('#zydw').html(a.zydw), $('#bz').html(a.bz), $('#hduser').html(a.hduser), $('#hdtime').html(a.hdtime) }), this.socket.on('message', function (b) { var c = new Date(), d = (b.userid == CHAT.userid, '<span>' + (c.getMonth() + 1) + '月' + c.getDate() + '日' + c.getHours() + ':' + c.getMinutes() + '</span>'); if (b.level == 66 && b.userid == CHAT.userid || CHAT.level != 66 && CHAT.belong == b.userid) { var e = '<img width="30" class="Role Manager2" src="/images/' + b.level + '.png">', f = '<strong>' + b.username + '：</strong>'; (CHAT.level == 66 && b.sendto != 'all' || CHAT.userid == b.sendto) && (f += '<img src="/images/r-middle-pic03.png"/><a>' + b.sendtoname + '</a>'); var g = ''; g = b.type == 'flower' ? '<p><img class="Picture" src="/images/xh.gif"/>' : '<p>' + CHAT.biaoqing(b.content), g += '</p>'; var h = a.createElement('li'); $(h).html(d + e + f + g), CHAT.userid != b.sendto && b.sendto != 'all' && CHAT.level != 66 || (a.getElementById('mastermessage').appendChild(h), $('#msmelist').mCustomScrollbar('update'), $('#msmelist').mCustomScrollbar('scrollTo', 'last')) } else if (b.level != 66 && b.userid == CHAT.userid || CHAT.level == 66 && b.belong == CHAT.userid) { var e = '<img width="30" class="Role Manager2" src="/images/' + b.level + '.png">', f = '<a><label class="usernlist">' + b.username + '</label>：</a>', g = ''; g = b.type === 'flower' ? '<p><img class="Picture" src="/images/xh.gif"/>' : '<p>' + CHAT.biaoqing(b.content), g += '</p>'; var h = a.createElement('li'); $(h).html(d + e + f + g), CHAT.msgObj.appendChild(h), $('#usermessage').mCustomScrollbar('update'), $('#usermessage').mCustomScrollbar('scrollTo', 'last') }CHAT.level === 66 && ($('.usernlist').addClass('clicksender'), $('.usernlist').click(function () { var a = b.userid; $('#sel').val(a) })) }) }}, a.getElementById('Y_iSend_Input').onkeydown = function (a) { a = a || event, a.keyCode === 13 && CHAT.submit() } }())

/*! live-0.0.0.js 2016-06-03 */
function Y_Vote_Close () { $('#Y_Vote').hide() } function Vote_Bind_Drag () { var a = $('#Y_Vote'), b = $('.Y_Vote_Title'); b.mousedown(function (b) { var c = $(this).offset(), d = b.pageX - c.left, e = b.pageY - c.top, f = a.position().left, g = a.position().top; $(document.body)[0].onselectstart = function () { return !1 }, $('body').addClass('NoSelect'), $(document).bind('mousemove', function (b) { var h = b.pageX - d - c.left, i = b.pageY - e - c.top, j = f + h, k = g + i; k < 0 && (k = 0), k + a.height() > $('body').height() && (k = $('body').height() - a.height()), j < a.width() / 2 && (j = a.width() / 2), Math.abs(j) > $('body').width() - a.width() / 2 && (j = $('body').width() - a.width() / 2), a.css('left', j), a.css('top', k) }), $(document).bind('mouseup', function (a) { $(document).unbind('mousemove'), $(document.body)[0].onselectstart = function () {}, $('body').removeClass('NoSelect') }) }) } function Vote_Init (a, b, c, d, e, f, g) { if (!(c == '' || d == '' || e < 1)) { var h = $('#Y_Vote'), j = $('#Y_Vote .Y_Vote_Title label'); j.html(b); var k = $('#Y_Vote_Time'); _Config.Vote_Time = parseInt(e), k.html(_Config.Vote_Time), _Config.Vote_TimeInterval = setInterval(function () { _Config.Vote_Time <= 0 && (clearInterval(_Config.Vote_TimeInterval), h.hide()), _Config.Vote_Time--, k.html(_Config.Vote_Time) }, 1e3); var l = $('#Y_Vote .Y_Vote_Content_List ul'), m = c.split(','), n = d.split(','), o = '<li id="VoteOp_{2}"><div class="Y_Vote_Content_List_OpLeft" title="{0}"><div><label>{0}</label></div></div><div class="Y_Vote_Content_List_OpRight"><label>{1}</label><input type="button" value="投票" class="{4}" onclick="Set_Vote(this,{3},{2})"></div></li>', p = 0; for (i = 0; i < m.length; i++) { var q = $.format(o, unescape(m[i]), n[i], i, a, f == -1 ? 'Vote_Button_Enable' : f.indexOf(i.toString()) != -1 ? 'Vote_Button_Enable' : ''); l.append(q), p += parseInt(n[i]) } for (h.show(), i = 0; i < m.length; i++) { var r = Math.round(n[i] / p * 100) ? Math.round(n[i] / p * 100) : 0; $(l.find('li')[i]).find('.Y_Vote_Content_List_OpLeft div').stop(!0).animate({width: (r < 1 ? 1 : r) + '%'}, g) } } } function Vote_Do (a) { var b = $('#VoteOp_' + a.VoteOp), c = parseInt(b.find('.Y_Vote_Content_List_OpRight label').html()) + 1; b.find('.Y_Vote_Content_List_OpRight label').html(c); var d = 0; $('#Y_Vote .Y_Vote_Content_List_OpRight label').each(function () { d += parseInt($(this).html()) }), $('#Y_Vote li').each(function () { var a = Math.round(parseInt($(this).find('.Y_Vote_Content_List_OpRight label').html()) / d * 100); $(this).find('.Y_Vote_Content_List_OpLeft div').stop(!0).animate({width: (a < 1 ? 1 : a) + '%'}, 300) }) } function Vote_GetRecord () { var vote_ul = $('#Y_Vote .Y_Vote_Content_List ul'); vote_ul.html(''), $.get('/Handle/GetVote.asp', {ac: 'GetVote', rid: iRoomID, t: getDataTimes()}, function (json) { var e = eval('(' + json + ')'); Vote_Init(e.id, e.title, e.ops, e.vs, e.time, e.dis, 900) }) } function Set_Vote (a, b, c) { if (iInfo.IsLogin == 0) return void iTip('游客无法参与投票！'); var d = $(a); return d.hasClass('Vote_Button_Enable') == 1 ? void iTip('您已经投过该选项！') : isNaN(b) || isNaN(c) ? void iTip('参数错误！') : void $.get('/Handle/SetVote.asp', {ac: 'SetVote', vid: b, v: c, t: getDataTimes()}, function () { if (SetVoteRe == 1) { var a = {}; a.Type = 'CMD_VoteUpdate', a.ReceiveRID = iInfo.Live_NG_ID, a.VoteOp = c, PostMsg(a), d.addClass('Vote_Button_Enable') } else SetVoteRe == 2 ? (d.addClass('Vote_Button_Enable'), iTip(SetVoteReMsg)) : ($('#Y_Vote input').addClass('Vote_Button_Enable'), iTip(SetVoteRe)) }, 'script') } function Start_Vote_CMD () { var a = {}; a.Type = 'CMD_Vote_Start', a.ReceiveRID = iInfo.Live_NG_ID, PostMsg(a) } function Stop_Vote_CMD () { var a = {}; a.Type = 'CMD_Vote_Stop', a.ReceiveRID = iInfo.Live_NG_ID, PostMsg(a) } function Start_Vote () { Vote_GetRecord() } function Stop_Vote () { _Config.Vote_Time = 0 }Vote_Bind_Drag(), $(function () { Vote_GetRecord() })

/*!
 * BootstrapSelection v0.1.0 (https://coding.net/u/packy/p/bootstrap-chinese-region/git)
 * Copyright 2015 packy <lpreterite@126.com>
 * Licensed under MIT (https://coding.net/u/packy/p/bootstrap-chinese-region/git/blob/master/LICENSE)
 */

!function(a,b){"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=b():"function"==typeof define&&define.amd?define("bs-chinese-region",["jquery","bootstrap"],b):b(a.jQuery)}(function(a){var b=function(b){this._areas=[],this._defaultId="",this.$el=b,this.$input=this.$el.find("input[type=text]"),this.$tabContent=this.$el.find(".tab-content"),this.$tabContent.children().first().on("click","a",a.proxy(this.onClearAreas,this)),this.$tabContent.children().on("click","a",a.proxy(this.onAreasChanged,this)),this.$tabContent.children().last().on("click","a",a.proxy(this.onClose,this)),this.$el.parents("form").on("submit",a.proxy(this.onSubmit,this)),a.fn.dropdown.Constructor&&this.initDropdownModule(),this._defaultId=void 0!==this.$el.data("def-val")?this.$el.find(this.$el.data("def-val")).val():this.$input.val(),this.submitType=this.$el.data("submit-type"),this.level(this.$el.data("min-level"),this.$el.data("max-level"))};b.prototype=new a.fn.dropdown.Constructor,b.prototype._toggle=b.prototype.toggle,b.prototype.toggle=function(){b.prototype._toggle.call(this.$input)},b.prototype.initDropdownModule=function(){this.$el.on("click",".dropdown-menu",function(b){a(b.target).trigger("click.bs.tab.data-api"),b.stopPropagation()})},b.prototype.onClearAreas=function(){this.areas=[]},b.prototype.onClose=function(b){this.toggle();this.getAreaData(a(b.target));this.$el.trigger("completed.bs.chinese-region",[this.areas])},b.prototype.onSubmit=function(){"id"==this.submitType&&this.$input.val(this.areas[this.areas.length-1].id)},b.prototype.getAreaData=function(a){var b=a.data();return b.name=a.text(),b},b.prototype.onAreasChanged=function(b){var c=a(b.target).attr("data-id");this.areas=this.getCurrentAreas(c),this.renderAreasPanel(this.getAreasByParentId(c)),this.$el.trigger("changed.bs.chinese-region",[this.areas])},b.prototype.getAreasByParentId=function(a){for(var b=[],c=0;c<this._source.length;c++)this._source[c].level>this.maxLevel||this._source[c].level<this.minLevel||this._source[c].parentId==a&&b.push(this._source[c]);return b},b.prototype.getAreasByLevel=function(a){for(var b=[],c=0;c<this._source.length;c++)this._source[c].level>this.maxLevel||this._source[c].level<this.minLevel||this._source[c].level==a&&b.push(this._source[c]);return b},b.prototype.getAreaById=function(a){for(var b,c=0;c<this._source.length;c++)if(this._source[c].id==a){b=this._source[c];break}return b},b.prototype.getCurrentAreas=function(a){for(var b=[],c=this.minLevel;c<=this.maxLevel;c++){var d=this.getAreaById(a);if(void 0===d)break;d.level>this.maxLevel||d.level<this.minLevel||(b.unshift(d),a=d.parentId)}return b},b.prototype.renderAreasPanel=function(a,b){var c,d;if(b?(c=this.$tabContent.children(":first"),d=this.$el.find(".nav-tabs li:first")):(c=this.$tabContent.children(".active").next(),d=this.$el.find(".nav-tabs li.active").next()),a&&a.length){c.empty();for(var e=0;e<a.length;e++){var f=a[e];c.append('<a href="javascript:;" class="areas-item" data-id="'+f.id+'" data-type="'+f.type+'">'+f.name+"</a> ")}}d.children("a").tab("show"),this.$input.val(""),this.$tabContent.children().find("a").removeClass("current");for(var e=0;e<this.areas.length;e++)this.$input.val(this.$input.val()+this.areas[e].name+" "),this.$tabContent.find("a[data-id="+this.areas[e].id+"]").addClass("current")},b.prototype.render=function(a){this.renderAreasPanel(this.getAreasByLevel(this.minLevel),!0),this.areas=this.getCurrentAreas(a);for(var b=0;b<this.areas.length;b++){var c=this.areas[b];this.renderAreasPanel(this.getAreasByParentId(c.id))}},b.prototype.source=function(a,b){return arguments.length<=0?this._source:(this._source="function"==typeof b?b(a):a,void this.render(this._defaultId))},b.prototype.level=function(a,b){this.minLevel=a,this.maxLevel=b},Object.defineProperty(b.prototype,"areas",{configurable:!1,get:function(){return this._areas},set:function(a){this._areas=a}}),Object.defineProperty(b.prototype,"minLevel",{configurable:!1,get:function(){return this._minLevel},set:function(a){this._minLevel=a}}),Object.defineProperty(b.prototype,"maxLevel",{configurable:!1,get:function(){return this._maxLevel},set:function(a){this._maxLevel=a}}),a.fn.chineseRegion=function(){var a=Array.prototype.shift.apply(arguments),c=arguments,d=this.data("bs-chinese-region");return void 0===d&&this.data("bs-chinese-region",d=new b(this)),"string"==typeof a&&d[a].apply(d,c),this},a.fn.chineseRegion.Constructor=b});